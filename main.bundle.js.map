{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/vector-3d.ts","webpack:///./node_modules/preact/dist/preact.mjs","webpack:///./src/matrix-3d.ts","webpack:///./src/webgl.ts","webpack:///./src/main.tsx","webpack:///./src/app-ui.tsx","webpack:///./src/keyboard.tsx","webpack:///./src/get-element.ts","webpack:///./src/app.ts","webpack:///./src/points-3d-renderer.ts","webpack:///./src/invertible-transforms-3d.ts","webpack:///./src/shapes.ts","webpack:///./src/points-3d.ts","webpack:///./src/screen-space.ts","webpack:///./src/ray-3d.ts","webpack:///./src/intersections.ts","webpack:///./src/color.ts","webpack:///./src/simple-vertex-shader.glsl","webpack:///./src/simple-fragment-shader.glsl"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Vector3D","[object Object]","x","y","z","w","this","v","len","Math","sqrt","__webpack_exports__","h","cloneElement","Component","render","rerender","options","VNode","stack","EMPTY_CHILDREN","nodeName","attributes","lastSimple","child","simple","children","arguments","length","push","pop","undefined","String","vnode","extend","obj","props","defer","Promise","resolve","then","setTimeout","slice","IS_NON_DIMENSIONAL","items","enqueueRender","component","_dirty","debounceRendering","list","renderComponent","isSameNodeType","node","hydrating","splitText","_componentConstructor","isNamedNode","normalizedNodeName","toLowerCase","getNodeProps","defaultProps","removeNode","parentNode","removeChild","setAccessor","old","isSvg","style","cssText","test","innerHTML","__html","useCapture","replace","substring","addEventListener","eventProxy","removeEventListener","_listeners","e","removeAttribute","removeAttributeNS","setAttributeNS","setAttribute","className","type","event","mounts","diffLevel","isSvgMode","flushMounts","afterMount","componentDidMount","diff","dom","context","mountAll","parent","componentRoot","ownerSVGElement","ret","idiff","appendChild","out","prevSvgMode","_component","nodeValue","document","createTextNode","replaceChild","recollectNodeTree","vnodeName","originalComponent","oldDom","isDirectOwner","isOwner","_parentComponent","constructor","setComponentProps","base","unmountComponent","createComponent","nextBase","buildComponentFromVNode","createElementNS","createElement","createNode","firstChild","fc","vchildren","a","nextSibling","isHydrating","j","f","vchild","originalChildren","childNodes","keyed","keyedLen","min","childrenLen","vlen","_child","__key","trim","insertBefore","innerDiffNode","dangerouslySetInnerHTML","attrs","diffAttributes","unmountOnly","ref","removeChildren","lastChild","next","previousSibling","recyclerComponents","Ctor","inst","doRender","splice","state","renderMode","_disable","__ref","getDerivedStateFromProps","componentWillMount","componentWillReceiveProps","prevContext","prevProps","syncComponentUpdates","isChild","rendered","cbase","previousProps","previousState","prevState","previousContext","isUpdate","initialBase","initialChildComponent","skip","snapshot","shouldComponentUpdate","componentWillUpdate","getChildContext","getSnapshotBeforeUpdate","toUnmount","childComponent","childProps","baseParent","componentRef","unshift","componentDidUpdate","afterUpdate","_renderCallbacks","beforeUnmount","componentWillUnmount","inner","merge","setState","callback","forceUpdate","preact","vector_3d_1","IDENTITY","Matrix3D","values","valueAt","Float32Array","row","column","fromVectorOrCoords","multiply","radians","cos","sin","m2","col1","transformVector","col2","col3","col4","map","near","far","left","right","top","bottom","width","height","depth","doubleNear","points","col","createShader","gl","source","shader","Error","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","msg","getShaderInfoLog","deleteShader","getAttribLocation","program","loc","GlProgram","vertexShaderSrc","fragmentShaderSrc","vertexShader","WebGLRenderingContext","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","GlUniformBase","location","getUniformLocation","GlUniformVector3D","uniform4fv","GlUniformFloat","uniform1f","GlUniformMatrix3D","uniformMatrix4fv","toFloat32Array","GlUniformBoolean","setupBuffer","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","preact_1","app_ui_1","get_element_1","app_1","window","app","App","getElement","run","AppUi","keyboard_1","Checkbox","handleToggle","onToggle","checked","onClick","label","hotkey","Hotkey","onPressed","super","getUi","dispatchAction","ui","showColliders","isPaused","showZBuffer","enableLighting","KeyboardMap","mapping","Map","body","handleEvent","handler","set","delete","globalKeyboardMapping","handlePress","unset","tagName","selector","finalSelector","querySelector","webgl_1","points_3d_renderer_1","matrix_3d_1","invertible_transforms_3d_1","shapes_1","screen_space_1","ray_3d_1","intersections_1","color_1","simpleVertexShaderSrc","zBufferFragmentShaderSrc","DRAW_RAY","PURPLE","Color","fromHex","BLUE","SimpleGlProgram","projectionTransform","viewTransform","modelTransform","color","light","normal","shade","positionAttributeLocation","Spaceship","colliderScale","transform","rotateZ","orbitTheta","translate","distanceFromCenter","scale","rotateY","shipTheta","random","orbitThetaVelocity","shipThetaVelocity","colliderRadius","ray","getRaySphereIntersection","center","CameraRay","cameraPosition","cameraTransform","matrix","screenPointInWorld","screenCoordsToWorld","canvas","coords","perspective","Ray3D","fromTo","makeRayPoints","renderer","Points3DRenderer","Scene","perspectiveProjection","InvertibleTransforms3D","cameraRotation","inverse","spaceships","ship","update","withColor","doesRayIntersect","queuedActions","getContext","spaceshipRenderer","makeSpaceship","groundRenderer","makeGround","circleRenderer","makeCircle","point","offsetX","offsetY","action","scene","viewport","enable","DEPTH_TEST","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","activate","BLACK","setupForDrawing","draw","LINES","forEach","spaceship","getColliderTransform","baseModelTransform","modelTransformUniform","rotateX","PI","LINE_LOOP","drawCollider","shootRay","amount","createRandom","createRandomSpaceships","createInitialScene","updateFrame","actions","processAction","requestAnimationFrame","enableVertexAttribArray","FLOAT","vertexAttribPointer","primitiveType","TRIANGLES","count","drawArrays","ops","op","vector","addOp","times","inverseOp","points_3d_1","mirror","leftHalf","transformPoints","Points3D","fromArray","concat","xzStart","size","pointsPerAxis","xPart","zPart","partInc","segments","origin","increment","direction","plus","start","array","result","arrIndex","combined","fn","numPoints","pointArray","Array","pointRelativeToCamera","xPct","yPct","screenCoordsToEye","normalize","from","to","minus","radius","originMinusCenter","b","dot","bSquaredMinusC","filter","closestT","sort","pointAlong","red","green","blue","alpha","hex","toFloat","parseInt","substr"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","/**\n * A three-dimensional vector. Note that it actually has\n * four elements because we use a homogeneous coordinate\n * system.\n */\nexport class Vector3D {\n  constructor(\n    readonly x: number = 0,\n    readonly y: number = 0,\n    readonly z: number = 0,\n    readonly w: number = 1.0\n  ) {}\n\n  perspectiveDivide(): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x / w, y / w, z / w);\n  }\n\n  minus(v: Vector3D): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x - v.x, y - v.y, z - v.z, w);\n  }\n\n  plus(v: Vector3D): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x + v.x, y + v.y, z + v.z, w);\n  }\n\n  times(n: number): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x * n, y * n, z * n, w);\n  }\n\n  dot(v: Vector3D): number {\n    const { x, y, z, w } = this;\n\n    return x * v.x + y * v.y + z * v.z;\n  }\n\n  normalize(): Vector3D {\n    const { x, y, z, w } = this;\n    const len = Math.sqrt(x * x + y * y + z * z);\n    return new Vector3D(x / len, y / len, z / len, w);\n  }\n\n  /**\n   * A helper to convert either a vector or a sequence of coordinates\n   * into a vector.\n   */\n  static fromVectorOrCoords(x: Vector3D | number, y?: number, z?: number): Vector3D {\n    z = x instanceof Vector3D ? x.z : z || 0;\n    y = x instanceof Vector3D ? x.y : y || 0;\n    x = x instanceof Vector3D ? x.x : x;\n    return new Vector3D(x, y, z);\n  }\n}","var VNode = function VNode() {};\n\nvar options = {};\n\nvar stack = [];\n\nvar EMPTY_CHILDREN = [];\n\nfunction h(nodeName, attributes) {\n\tvar children = EMPTY_CHILDREN,\n\t    lastSimple,\n\t    child,\n\t    simple,\n\t    i;\n\tfor (i = arguments.length; i-- > 2;) {\n\t\tstack.push(arguments[i]);\n\t}\n\tif (attributes && attributes.children != null) {\n\t\tif (!stack.length) stack.push(attributes.children);\n\t\tdelete attributes.children;\n\t}\n\twhile (stack.length) {\n\t\tif ((child = stack.pop()) && child.pop !== undefined) {\n\t\t\tfor (i = child.length; i--;) {\n\t\t\t\tstack.push(child[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tif (typeof child === 'boolean') child = null;\n\n\t\t\tif (simple = typeof nodeName !== 'function') {\n\t\t\t\tif (child == null) child = '';else if (typeof child === 'number') child = String(child);else if (typeof child !== 'string') simple = false;\n\t\t\t}\n\n\t\t\tif (simple && lastSimple) {\n\t\t\t\tchildren[children.length - 1] += child;\n\t\t\t} else if (children === EMPTY_CHILDREN) {\n\t\t\t\tchildren = [child];\n\t\t\t} else {\n\t\t\t\tchildren.push(child);\n\t\t\t}\n\n\t\t\tlastSimple = simple;\n\t\t}\n\t}\n\n\tvar p = new VNode();\n\tp.nodeName = nodeName;\n\tp.children = children;\n\tp.attributes = attributes == null ? undefined : attributes;\n\tp.key = attributes == null ? undefined : attributes.key;\n\n\tif (options.vnode !== undefined) options.vnode(p);\n\n\treturn p;\n}\n\nfunction extend(obj, props) {\n  for (var i in props) {\n    obj[i] = props[i];\n  }return obj;\n}\n\nvar defer = typeof Promise == 'function' ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\n\nfunction cloneElement(vnode, props) {\n  return h(vnode.nodeName, extend(extend({}, vnode.attributes), props), arguments.length > 2 ? [].slice.call(arguments, 2) : vnode.children);\n}\n\nvar IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\n\nvar items = [];\n\nfunction enqueueRender(component) {\n\tif (!component._dirty && (component._dirty = true) && items.push(component) == 1) {\n\t\t(options.debounceRendering || defer)(rerender);\n\t}\n}\n\nfunction rerender() {\n\tvar p,\n\t    list = items;\n\titems = [];\n\twhile (p = list.pop()) {\n\t\tif (p._dirty) renderComponent(p);\n\t}\n}\n\nfunction isSameNodeType(node, vnode, hydrating) {\n\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\treturn node.splitText !== undefined;\n\t}\n\tif (typeof vnode.nodeName === 'string') {\n\t\treturn !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n\t}\n\treturn hydrating || node._componentConstructor === vnode.nodeName;\n}\n\nfunction isNamedNode(node, nodeName) {\n\treturn node.normalizedNodeName === nodeName || node.nodeName.toLowerCase() === nodeName.toLowerCase();\n}\n\nfunction getNodeProps(vnode) {\n\tvar props = extend({}, vnode.attributes);\n\tprops.children = vnode.children;\n\n\tvar defaultProps = vnode.nodeName.defaultProps;\n\tif (defaultProps !== undefined) {\n\t\tfor (var i in defaultProps) {\n\t\t\tif (props[i] === undefined) {\n\t\t\t\tprops[i] = defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn props;\n}\n\nfunction createNode(nodeName, isSvg) {\n\tvar node = isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName);\n\tnode.normalizedNodeName = nodeName;\n\treturn node;\n}\n\nfunction removeNode(node) {\n\tvar parentNode = node.parentNode;\n\tif (parentNode) parentNode.removeChild(node);\n}\n\nfunction setAccessor(node, name, old, value, isSvg) {\n\tif (name === 'className') name = 'class';\n\n\tif (name === 'key') {} else if (name === 'ref') {\n\t\tif (old) old(null);\n\t\tif (value) value(node);\n\t} else if (name === 'class' && !isSvg) {\n\t\tnode.className = value || '';\n\t} else if (name === 'style') {\n\t\tif (!value || typeof value === 'string' || typeof old === 'string') {\n\t\t\tnode.style.cssText = value || '';\n\t\t}\n\t\tif (value && typeof value === 'object') {\n\t\t\tif (typeof old !== 'string') {\n\t\t\t\tfor (var i in old) {\n\t\t\t\t\tif (!(i in value)) node.style[i] = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i in value) {\n\t\t\t\tnode.style[i] = typeof value[i] === 'number' && IS_NON_DIMENSIONAL.test(i) === false ? value[i] + 'px' : value[i];\n\t\t\t}\n\t\t}\n\t} else if (name === 'dangerouslySetInnerHTML') {\n\t\tif (value) node.innerHTML = value.__html || '';\n\t} else if (name[0] == 'o' && name[1] == 'n') {\n\t\tvar useCapture = name !== (name = name.replace(/Capture$/, ''));\n\t\tname = name.toLowerCase().substring(2);\n\t\tif (value) {\n\t\t\tif (!old) node.addEventListener(name, eventProxy, useCapture);\n\t\t} else {\n\t\t\tnode.removeEventListener(name, eventProxy, useCapture);\n\t\t}\n\t\t(node._listeners || (node._listeners = {}))[name] = value;\n\t} else if (name !== 'list' && name !== 'type' && !isSvg && name in node) {\n\t\ttry {\n\t\t\tnode[name] = value == null ? '' : value;\n\t\t} catch (e) {}\n\t\tif ((value == null || value === false) && name != 'spellcheck') node.removeAttribute(name);\n\t} else {\n\t\tvar ns = isSvg && name !== (name = name.replace(/^xlink:?/, ''));\n\n\t\tif (value == null || value === false) {\n\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase());else node.removeAttribute(name);\n\t\t} else if (typeof value !== 'function') {\n\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase(), value);else node.setAttribute(name, value);\n\t\t}\n\t}\n}\n\nfunction eventProxy(e) {\n\treturn this._listeners[e.type](options.event && options.event(e) || e);\n}\n\nvar mounts = [];\n\nvar diffLevel = 0;\n\nvar isSvgMode = false;\n\nvar hydrating = false;\n\nfunction flushMounts() {\n\tvar c;\n\twhile (c = mounts.pop()) {\n\t\tif (options.afterMount) options.afterMount(c);\n\t\tif (c.componentDidMount) c.componentDidMount();\n\t}\n}\n\nfunction diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\tif (!diffLevel++) {\n\t\tisSvgMode = parent != null && parent.ownerSVGElement !== undefined;\n\n\t\thydrating = dom != null && !('__preactattr_' in dom);\n\t}\n\n\tvar ret = idiff(dom, vnode, context, mountAll, componentRoot);\n\n\tif (parent && ret.parentNode !== parent) parent.appendChild(ret);\n\n\tif (! --diffLevel) {\n\t\thydrating = false;\n\n\t\tif (!componentRoot) flushMounts();\n\t}\n\n\treturn ret;\n}\n\nfunction idiff(dom, vnode, context, mountAll, componentRoot) {\n\tvar out = dom,\n\t    prevSvgMode = isSvgMode;\n\n\tif (vnode == null || typeof vnode === 'boolean') vnode = '';\n\n\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\tif (dom && dom.splitText !== undefined && dom.parentNode && (!dom._component || componentRoot)) {\n\t\t\tif (dom.nodeValue != vnode) {\n\t\t\t\tdom.nodeValue = vnode;\n\t\t\t}\n\t\t} else {\n\t\t\tout = document.createTextNode(vnode);\n\t\t\tif (dom) {\n\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t}\n\t\t}\n\n\t\tout['__preactattr_'] = true;\n\n\t\treturn out;\n\t}\n\n\tvar vnodeName = vnode.nodeName;\n\tif (typeof vnodeName === 'function') {\n\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t}\n\n\tisSvgMode = vnodeName === 'svg' ? true : vnodeName === 'foreignObject' ? false : isSvgMode;\n\n\tvnodeName = String(vnodeName);\n\tif (!dom || !isNamedNode(dom, vnodeName)) {\n\t\tout = createNode(vnodeName, isSvgMode);\n\n\t\tif (dom) {\n\t\t\twhile (dom.firstChild) {\n\t\t\t\tout.appendChild(dom.firstChild);\n\t\t\t}\n\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t\trecollectNodeTree(dom, true);\n\t\t}\n\t}\n\n\tvar fc = out.firstChild,\n\t    props = out['__preactattr_'],\n\t    vchildren = vnode.children;\n\n\tif (props == null) {\n\t\tprops = out['__preactattr_'] = {};\n\t\tfor (var a = out.attributes, i = a.length; i--;) {\n\t\t\tprops[a[i].name] = a[i].value;\n\t\t}\n\t}\n\n\tif (!hydrating && vchildren && vchildren.length === 1 && typeof vchildren[0] === 'string' && fc != null && fc.splitText !== undefined && fc.nextSibling == null) {\n\t\tif (fc.nodeValue != vchildren[0]) {\n\t\t\tfc.nodeValue = vchildren[0];\n\t\t}\n\t} else if (vchildren && vchildren.length || fc != null) {\n\t\t\tinnerDiffNode(out, vchildren, context, mountAll, hydrating || props.dangerouslySetInnerHTML != null);\n\t\t}\n\n\tdiffAttributes(out, vnode.attributes, props);\n\n\tisSvgMode = prevSvgMode;\n\n\treturn out;\n}\n\nfunction innerDiffNode(dom, vchildren, context, mountAll, isHydrating) {\n\tvar originalChildren = dom.childNodes,\n\t    children = [],\n\t    keyed = {},\n\t    keyedLen = 0,\n\t    min = 0,\n\t    len = originalChildren.length,\n\t    childrenLen = 0,\n\t    vlen = vchildren ? vchildren.length : 0,\n\t    j,\n\t    c,\n\t    f,\n\t    vchild,\n\t    child;\n\n\tif (len !== 0) {\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar _child = originalChildren[i],\n\t\t\t    props = _child['__preactattr_'],\n\t\t\t    key = vlen && props ? _child._component ? _child._component.__key : props.key : null;\n\t\t\tif (key != null) {\n\t\t\t\tkeyedLen++;\n\t\t\t\tkeyed[key] = _child;\n\t\t\t} else if (props || (_child.splitText !== undefined ? isHydrating ? _child.nodeValue.trim() : true : isHydrating)) {\n\t\t\t\tchildren[childrenLen++] = _child;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (vlen !== 0) {\n\t\tfor (var i = 0; i < vlen; i++) {\n\t\t\tvchild = vchildren[i];\n\t\t\tchild = null;\n\n\t\t\tvar key = vchild.key;\n\t\t\tif (key != null) {\n\t\t\t\tif (keyedLen && keyed[key] !== undefined) {\n\t\t\t\t\tchild = keyed[key];\n\t\t\t\t\tkeyed[key] = undefined;\n\t\t\t\t\tkeyedLen--;\n\t\t\t\t}\n\t\t\t} else if (min < childrenLen) {\n\t\t\t\t\tfor (j = min; j < childrenLen; j++) {\n\t\t\t\t\t\tif (children[j] !== undefined && isSameNodeType(c = children[j], vchild, isHydrating)) {\n\t\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\t\tif (j === childrenLen - 1) childrenLen--;\n\t\t\t\t\t\t\tif (j === min) min++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\tf = originalChildren[i];\n\t\t\tif (child && child !== dom && child !== f) {\n\t\t\t\tif (f == null) {\n\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t} else if (child === f.nextSibling) {\n\t\t\t\t\tremoveNode(f);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertBefore(child, f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (keyedLen) {\n\t\tfor (var i in keyed) {\n\t\t\tif (keyed[i] !== undefined) recollectNodeTree(keyed[i], false);\n\t\t}\n\t}\n\n\twhile (min <= childrenLen) {\n\t\tif ((child = children[childrenLen--]) !== undefined) recollectNodeTree(child, false);\n\t}\n}\n\nfunction recollectNodeTree(node, unmountOnly) {\n\tvar component = node._component;\n\tif (component) {\n\t\tunmountComponent(component);\n\t} else {\n\t\tif (node['__preactattr_'] != null && node['__preactattr_'].ref) node['__preactattr_'].ref(null);\n\n\t\tif (unmountOnly === false || node['__preactattr_'] == null) {\n\t\t\tremoveNode(node);\n\t\t}\n\n\t\tremoveChildren(node);\n\t}\n}\n\nfunction removeChildren(node) {\n\tnode = node.lastChild;\n\twhile (node) {\n\t\tvar next = node.previousSibling;\n\t\trecollectNodeTree(node, true);\n\t\tnode = next;\n\t}\n}\n\nfunction diffAttributes(dom, attrs, old) {\n\tvar name;\n\n\tfor (name in old) {\n\t\tif (!(attrs && attrs[name] != null) && old[name] != null) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t}\n\t}\n\n\tfor (name in attrs) {\n\t\tif (name !== 'children' && name !== 'innerHTML' && (!(name in old) || attrs[name] !== (name === 'value' || name === 'checked' ? dom[name] : old[name]))) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t}\n\t}\n}\n\nvar recyclerComponents = [];\n\nfunction createComponent(Ctor, props, context) {\n\tvar inst,\n\t    i = recyclerComponents.length;\n\n\tif (Ctor.prototype && Ctor.prototype.render) {\n\t\tinst = new Ctor(props, context);\n\t\tComponent.call(inst, props, context);\n\t} else {\n\t\tinst = new Component(props, context);\n\t\tinst.constructor = Ctor;\n\t\tinst.render = doRender;\n\t}\n\n\twhile (i--) {\n\t\tif (recyclerComponents[i].constructor === Ctor) {\n\t\t\tinst.nextBase = recyclerComponents[i].nextBase;\n\t\t\trecyclerComponents.splice(i, 1);\n\t\t\treturn inst;\n\t\t}\n\t}\n\n\treturn inst;\n}\n\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n\nfunction setComponentProps(component, props, renderMode, context, mountAll) {\n\tif (component._disable) return;\n\tcomponent._disable = true;\n\n\tcomponent.__ref = props.ref;\n\tcomponent.__key = props.key;\n\tdelete props.ref;\n\tdelete props.key;\n\n\tif (typeof component.constructor.getDerivedStateFromProps === 'undefined') {\n\t\tif (!component.base || mountAll) {\n\t\t\tif (component.componentWillMount) component.componentWillMount();\n\t\t} else if (component.componentWillReceiveProps) {\n\t\t\tcomponent.componentWillReceiveProps(props, context);\n\t\t}\n\t}\n\n\tif (context && context !== component.context) {\n\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\tcomponent.context = context;\n\t}\n\n\tif (!component.prevProps) component.prevProps = component.props;\n\tcomponent.props = props;\n\n\tcomponent._disable = false;\n\n\tif (renderMode !== 0) {\n\t\tif (renderMode === 1 || options.syncComponentUpdates !== false || !component.base) {\n\t\t\trenderComponent(component, 1, mountAll);\n\t\t} else {\n\t\t\tenqueueRender(component);\n\t\t}\n\t}\n\n\tif (component.__ref) component.__ref(component);\n}\n\nfunction renderComponent(component, renderMode, mountAll, isChild) {\n\tif (component._disable) return;\n\n\tvar props = component.props,\n\t    state = component.state,\n\t    context = component.context,\n\t    previousProps = component.prevProps || props,\n\t    previousState = component.prevState || state,\n\t    previousContext = component.prevContext || context,\n\t    isUpdate = component.base,\n\t    nextBase = component.nextBase,\n\t    initialBase = isUpdate || nextBase,\n\t    initialChildComponent = component._component,\n\t    skip = false,\n\t    snapshot = previousContext,\n\t    rendered,\n\t    inst,\n\t    cbase;\n\n\tif (component.constructor.getDerivedStateFromProps) {\n\t\tstate = extend(extend({}, state), component.constructor.getDerivedStateFromProps(props, state));\n\t\tcomponent.state = state;\n\t}\n\n\tif (isUpdate) {\n\t\tcomponent.props = previousProps;\n\t\tcomponent.state = previousState;\n\t\tcomponent.context = previousContext;\n\t\tif (renderMode !== 2 && component.shouldComponentUpdate && component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\tskip = true;\n\t\t} else if (component.componentWillUpdate) {\n\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t}\n\t\tcomponent.props = props;\n\t\tcomponent.state = state;\n\t\tcomponent.context = context;\n\t}\n\n\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\tcomponent._dirty = false;\n\n\tif (!skip) {\n\t\trendered = component.render(props, state, context);\n\n\t\tif (component.getChildContext) {\n\t\t\tcontext = extend(extend({}, context), component.getChildContext());\n\t\t}\n\n\t\tif (isUpdate && component.getSnapshotBeforeUpdate) {\n\t\t\tsnapshot = component.getSnapshotBeforeUpdate(previousProps, previousState);\n\t\t}\n\n\t\tvar childComponent = rendered && rendered.nodeName,\n\t\t    toUnmount,\n\t\t    base;\n\n\t\tif (typeof childComponent === 'function') {\n\n\t\t\tvar childProps = getNodeProps(rendered);\n\t\t\tinst = initialChildComponent;\n\n\t\t\tif (inst && inst.constructor === childComponent && childProps.key == inst.__key) {\n\t\t\t\tsetComponentProps(inst, childProps, 1, context, false);\n\t\t\t} else {\n\t\t\t\ttoUnmount = inst;\n\n\t\t\t\tcomponent._component = inst = createComponent(childComponent, childProps, context);\n\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\tinst._parentComponent = component;\n\t\t\t\tsetComponentProps(inst, childProps, 0, context, false);\n\t\t\t\trenderComponent(inst, 1, mountAll, true);\n\t\t\t}\n\n\t\t\tbase = inst.base;\n\t\t} else {\n\t\t\tcbase = initialBase;\n\n\t\t\ttoUnmount = initialChildComponent;\n\t\t\tif (toUnmount) {\n\t\t\t\tcbase = component._component = null;\n\t\t\t}\n\n\t\t\tif (initialBase || renderMode === 1) {\n\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t}\n\t\t}\n\n\t\tif (initialBase && base !== initialBase && inst !== initialChildComponent) {\n\t\t\tvar baseParent = initialBase.parentNode;\n\t\t\tif (baseParent && base !== baseParent) {\n\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\tif (!toUnmount) {\n\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\trecollectNodeTree(initialBase, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (toUnmount) {\n\t\t\tunmountComponent(toUnmount);\n\t\t}\n\n\t\tcomponent.base = base;\n\t\tif (base && !isChild) {\n\t\t\tvar componentRef = component,\n\t\t\t    t = component;\n\t\t\twhile (t = t._parentComponent) {\n\t\t\t\t(componentRef = t).base = base;\n\t\t\t}\n\t\t\tbase._component = componentRef;\n\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t}\n\t}\n\n\tif (!isUpdate || mountAll) {\n\t\tmounts.unshift(component);\n\t} else if (!skip) {\n\n\t\tif (component.componentDidUpdate) {\n\t\t\tcomponent.componentDidUpdate(previousProps, previousState, snapshot);\n\t\t}\n\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t}\n\n\twhile (component._renderCallbacks.length) {\n\t\tcomponent._renderCallbacks.pop().call(component);\n\t}if (!diffLevel && !isChild) flushMounts();\n}\n\nfunction buildComponentFromVNode(dom, vnode, context, mountAll) {\n\tvar c = dom && dom._component,\n\t    originalComponent = c,\n\t    oldDom = dom,\n\t    isDirectOwner = c && dom._componentConstructor === vnode.nodeName,\n\t    isOwner = isDirectOwner,\n\t    props = getNodeProps(vnode);\n\twhile (c && !isOwner && (c = c._parentComponent)) {\n\t\tisOwner = c.constructor === vnode.nodeName;\n\t}\n\n\tif (c && isOwner && (!mountAll || c._component)) {\n\t\tsetComponentProps(c, props, 3, context, mountAll);\n\t\tdom = c.base;\n\t} else {\n\t\tif (originalComponent && !isDirectOwner) {\n\t\t\tunmountComponent(originalComponent);\n\t\t\tdom = oldDom = null;\n\t\t}\n\n\t\tc = createComponent(vnode.nodeName, props, context);\n\t\tif (dom && !c.nextBase) {\n\t\t\tc.nextBase = dom;\n\n\t\t\toldDom = null;\n\t\t}\n\t\tsetComponentProps(c, props, 1, context, mountAll);\n\t\tdom = c.base;\n\n\t\tif (oldDom && dom !== oldDom) {\n\t\t\toldDom._component = null;\n\t\t\trecollectNodeTree(oldDom, false);\n\t\t}\n\t}\n\n\treturn dom;\n}\n\nfunction unmountComponent(component) {\n\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\tvar base = component.base;\n\n\tcomponent._disable = true;\n\n\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\tcomponent.base = null;\n\n\tvar inner = component._component;\n\tif (inner) {\n\t\tunmountComponent(inner);\n\t} else if (base) {\n\t\tif (base['__preactattr_'] && base['__preactattr_'].ref) base['__preactattr_'].ref(null);\n\n\t\tcomponent.nextBase = base;\n\n\t\tremoveNode(base);\n\t\trecyclerComponents.push(component);\n\n\t\tremoveChildren(base);\n\t}\n\n\tif (component.__ref) component.__ref(null);\n}\n\nfunction Component(props, context) {\n\tthis._dirty = true;\n\n\tthis.context = context;\n\n\tthis.props = props;\n\n\tthis.state = this.state || {};\n\n\tthis._renderCallbacks = [];\n}\n\nextend(Component.prototype, {\n\tsetState: function setState(state, callback) {\n\t\tif (!this.prevState) this.prevState = this.state;\n\t\tthis.state = extend(extend({}, this.state), typeof state === 'function' ? state(this.state, this.props) : state);\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t},\n\tforceUpdate: function forceUpdate(callback) {\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\trenderComponent(this, 2);\n\t},\n\trender: function render() {}\n});\n\nfunction render(vnode, parent, merge) {\n  return diff(merge, vnode, {}, false, parent, false);\n}\n\nvar preact = {\n\th: h,\n\tcreateElement: h,\n\tcloneElement: cloneElement,\n\tComponent: Component,\n\trender: render,\n\trerender: rerender,\n\toptions: options\n};\n\nexport default preact;\nexport { h, h as createElement, cloneElement, Component, render, rerender, options };\n//# sourceMappingURL=preact.mjs.map\n","import { Vector3D } from \"./vector-3d\";\nimport { Points3D } from \"./points-3d\";\n\ntype Column = 1|2|3|4;\ntype Row = 1|2|3|4;\n\n/**\n * A 4x4 matrix represented as\n * a two-dimensional array in\n * row-major order.\n */\ntype Matrix3DTuple = [\n  [number, number, number, number],\n  [number, number, number, number],\n  [number, number, number, number],\n  [number, number, number, number]\n];\n\nexport type PerspectiveOptions = {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n  near: number;\n  far: number;\n};\n\nconst IDENTITY: Matrix3DTuple = [\n  [1, 0, 0, 0],\n  [0, 1, 0, 0],\n  [0, 0, 1, 0],\n  [0, 0, 0, 1]\n];\n\n/**\n * A three-dimensional matrix. Note that it ultimately represents a 4x4\n * matrix because we use homogeneous coordinates.\n */\nexport class Matrix3D {\n  constructor(readonly values: Matrix3DTuple = IDENTITY) {\n    this.valueAt = this.valueAt.bind(this);\n  }\n\n  /**\n   * Convert the matrix into a Float32Array in column-major order\n   * (the layout that GLSL expects).\n   */\n  toFloat32Array(): Float32Array {\n    const m = this.valueAt;\n    return new Float32Array([\n      m(1, 1), m(2, 1), m(3, 1), m(4, 1),\n      m(1, 2), m(2, 2), m(3, 2), m(4, 2),\n      m(1, 3), m(2, 3), m(3, 3), m(4, 3),\n      m(1, 4), m(2, 4), m(3, 4), m(4, 4),\n    ]);\n  }\n\n  valueAt(row: Row, column: Column): number {\n    return this.values[row - 1][column - 1];\n  }\n\n  translate(v: Vector3D): Matrix3D;\n  translate(x: number, y: number, z: number): Matrix3D;\n\n  translate(x: Vector3D|number, y?: number, z?: number): Matrix3D {\n    const v = Vector3D.fromVectorOrCoords(x, y, z);\n\n    return this.multiply(new Matrix3D([\n      [1, 0, 0, v.x],\n      [0, 1, 0, v.y],\n      [0, 0, 1, v.z],\n      [0, 0, 0,   1]\n    ]));\n  }\n\n  scale(x: number, y?: number, z?: number): Matrix3D {\n    if (y === undefined) {\n      y = x;\n    }\n    if (z === undefined) {\n      z = y;\n    }\n    return this.multiply(new Matrix3D([\n      [x, 0, 0, 0],\n      [0, y, 0, 0],\n      [0, 0, z, 0],\n      [0, 0, 0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the X axis. */\n  rotateX(radians: number) {\n    // Deriving this requires the trigonometric identities for angle sums:\n    //\n    //   https://en.wikipedia.org/wiki/List_of_trigonometric_identities\n    //\n    // That said, I think an alternative approach is to think of rotation\n    // as transformation of basis vectors via matrix multiplication,\n    // which simplifies things conceptually.\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [1,  0, 0, 0],\n      [0,  c, s, 0],\n      [0, -s, c, 0],\n      [0,  0, 0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the Y axis. */\n  rotateY(radians: number) {\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [c, 0, -s, 0],\n      [0, 1,  0, 0],\n      [s, 0,  c, 0],\n      [0, 0,  0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the Z axis. */\n  rotateZ(radians: number) {\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [c, -s, 0, 0],\n      [s,  c, 0, 0],\n      [0,  0, 1, 0],\n      [0,  0, 0, 1]\n    ]));\n  }\n\n  multiply(m2: Matrix3D): Matrix3D {\n    // Conceptualy, it's easiest to think of matrix multiplication\n    // as a transformation of a coordinate system's basis\n    // vectors:\n    //\n    //   http://www.3blue1brown.com/essence-of-linear-algebra-page/\n    //\n    // This isn't particularly efficient code, but hopefully\n    // it is readable.\n    const col1 = this.transformVector(m2.column(1));\n    const col2 = this.transformVector(m2.column(2));\n    const col3 = this.transformVector(m2.column(3));\n    const col4 = this.transformVector(m2.column(4));\n    return new Matrix3D([\n      [col1.x, col2.x, col3.x, col4.x],\n      [col1.y, col2.y, col3.y, col4.y],\n      [col1.z, col2.z, col3.z, col4.z],\n      [col1.w, col2.w, col3.w, col4.w],\n    ]);\n  }\n\n  /**\n   * Apply the given function to every element of the matrix, returning\n   * a new one.\n   */\n  map(f: (value: number) => number): Matrix3D {\n    return new Matrix3D(this.values.map(row => row.map(f)) as Matrix3DTuple);\n  }\n\n  /**\n   * Multiply all elements of the matrix by the given constant,\n   * returning a new matrix.\n   */\n  multiplyByConstant(n: number): Matrix3D {\n    return this.map(value => value * n);\n  }\n\n  /**\n   * Create a matrix that transforms eye coordinates into clip\n   * coordinates.\n   * \n   * Note that clip coordinates will likely have a w-component\n   * that is not 1; the GPU will perform a perspective divide\n   * after the vertex shader to convert the clip coordinates\n   * into normalized device coordinates (NDC).\n   * \n   * Note also that the near and far parameters must be\n   * specified as positive numbers, as the clip coordinates\n   * use a left-handed coordinate system, while the\n   * eye coordinates use a right-handed coordinate system,\n   * and the projection matrix will convert between the\n   * two.\n   * \n   * For more details, as well as an excellent derivation\n   * of all the math behind all this, see:\n   * \n   *   http://www.songho.ca/opengl/gl_projectionmatrix.html#perspective\n   */\n  static perspectiveProjection(options: PerspectiveOptions): Matrix3D {\n    const { near, far, left, right, top, bottom } = options;\n    const width = right - left;\n    const height = top - bottom;\n    const depth = far - near;\n    const doubleNear = 2 * near;\n    return new Matrix3D([\n      [doubleNear / width, 0, (right + left) / width, 0],\n      [0, doubleNear / height, (top + bottom) / height, 0],\n      [0, 0, -(far + near) / depth, -2 * far * near / depth],\n      [0, 0, -1, 0]\n    ]);\n  }\n\n  transformPoints(points: Points3D): Points3D {\n    return points.map(v => this.transformVector(v));\n  }\n\n  transformVector(v: Vector3D): Vector3D {\n    const m = this.valueAt;\n    return new Vector3D(\n      m(1, 1) * v.x + m(1, 2) * v.y + m(1, 3) * v.z + m(1, 4) * v.w,\n      m(2, 1) * v.x + m(2, 2) * v.y + m(2, 3) * v.z + m(2, 4) * v.w,\n      m(3, 1) * v.x + m(3, 2) * v.y + m(3, 3) * v.z + m(3, 4) * v.w,\n      m(4, 1) * v.x + m(4, 2) * v.y + m(4, 3) * v.z + m(4, 4) * v.w,\n    );\n  }\n\n  column(col: Column): Vector3D {\n    const m = this.valueAt;\n    return new Vector3D(\n      m(1, col),\n      m(2, col),\n      m(3, col),\n      m(4, col)\n    );\n  }\n}\n","import { Matrix3D } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\nfunction createShader(gl: WebGLRenderingContext, type: number, source: string): WebGLShader {\n  const shader = gl.createShader(type);\n  if (!shader) throw new Error(\"gl.createShader() failed!\");\n\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n  if (!success) {\n    const msg = \"Compiling shader failed: \" + gl.getShaderInfoLog(shader);\n    gl.deleteShader(shader);\n    throw new Error(msg);\n  }\n\n  return shader;\n}\n\nfunction createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n  const program = gl.createProgram();\n  if (!program) throw new Error(\"gl.createProgram() failed!\");\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (!success) {\n    const msg = \"Linking program failed: \" + gl.getProgramInfoLog(program);\n    gl.deleteProgram(program);\n    throw new Error(msg);\n  }\n\n  return program;\n}\n\nfunction getUniformLocation(gl: WebGLRenderingContext, program: WebGLProgram, name: string): WebGLUniformLocation {\n  const loc = gl.getUniformLocation(program, name);\n\n  if (loc === null) {\n    throw new Error(`Unable to find uniform '${name}'!`);\n  }\n\n  return loc;\n}\n\nexport function getAttribLocation(gl: WebGLRenderingContext, program: WebGLProgram, name: string): number {\n  const loc = gl.getAttribLocation(program, name);\n\n  if (loc === -1) {\n    throw new Error(`Unable to find attribute '${name}'!`);\n  }\n\n  return loc;\n}\n\nexport class GlProgram {\n  readonly program: WebGLProgram;\n\n  constructor(readonly gl: WebGLRenderingContext, vertexShaderSrc: string, fragmentShaderSrc: string) {\n    const vertexShader = createShader(gl, WebGLRenderingContext.VERTEX_SHADER, vertexShaderSrc);\n    const fragmentShader = createShader(gl, WebGLRenderingContext.FRAGMENT_SHADER, fragmentShaderSrc);\n    this.program = createProgram(gl, vertexShader, fragmentShader);\n  }\n\n  activate() {\n    this.gl.useProgram(this.program);\n  }\n}\n\nclass GlUniformBase {\n  location: WebGLUniformLocation;\n\n  constructor(readonly program: GlProgram, name: string) {\n    this.location = getUniformLocation(program.gl, program.program, name);\n  }\n}\n\nexport class GlUniformVector3D extends GlUniformBase {\n  set(value: Vector3D) {\n    this.program.gl.uniform4fv(this.location, [value.x, value.y, value.z, value.w]);\n  }\n}\n\nexport class GlUniformFloat extends GlUniformBase {\n  set(value: number) {\n    this.program.gl.uniform1f(this.location, value);\n  }\n}\n\nexport class GlUniformMatrix3D extends GlUniformBase {\n  set(value: Matrix3D) {\n    this.program.gl.uniformMatrix4fv(this.location, false, value.toFloat32Array());\n  }\n}\n\nexport class GlUniformBoolean extends GlUniformBase {\n  set(value: boolean) {\n    this.program.gl.uniform1f(this.location, value ? 1 : 0);\n  }\n}\n\nexport function setupBuffer(gl: WebGLRenderingContext, value: Float32Array): WebGLBuffer {\n  const buffer = gl.createBuffer();\n\n  if (buffer === null) {\n    throw new Error(\"gl.createBuffer() failed!\");\n  }\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, value, gl.STATIC_DRAW);\n\n  return buffer;\n}\n","import { h, render } from \"preact\";\nimport { AppUi } from \"./app-ui\";\nimport { getElement } from \"./get-element\";\nimport { App } from \"./app\";\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  const app = new App(getElement('canvas', '#canvas'));\n\n  app.run();\n\n  render(<AppUi app={app} />, getElement('div', '#app-ui'));\n});\n","import { h, Component } from 'preact';\nimport { App } from './app';\nimport { Hotkey } from './keyboard';\n\ninterface CheckboxProps {\n  label: string;\n  checked: boolean;\n  onToggle: (newValue: boolean) => void;\n  hotkey?: string;\n}\n\nfunction Checkbox(props: CheckboxProps): JSX.Element {\n  const handleToggle = () => props.onToggle(!props.checked);\n\n  return (\n    <label>\n      <input type=\"checkbox\"\n            checked={props.checked}\n            onClick={handleToggle} /> {props.label}{' '}\n      {props.hotkey && <Hotkey onPressed={handleToggle} hotkey={props.hotkey} />}\n    </label>\n  );\n}\n\ninterface AppUiProps {\n  app: App\n}\n\nexport type AppUiState = {\n  showColliders: boolean;\n  isPaused: boolean;\n  showZBuffer: boolean;\n  enableLighting: boolean;\n};\n\nexport class AppUi extends Component<AppUiProps, AppUiState> {\n  constructor(props: AppUiProps) {\n    super(props);\n    this.state = props.app.getUi();\n  }\n\n  componentDidUpdate() {\n    this.props.app.dispatchAction({ type: 'uiupdate', ui: this.state });\n  }\n\n  render(props: AppUiProps, state: AppUiState): JSX.Element {\n    return (\n      <div className=\"ui-wrapper\">\n        <div className=\"ui\">\n          <Checkbox checked={state.showColliders}\n                    label=\"Show colliders\"\n                    hotkey=\"c\"\n                    onToggle={showColliders => this.setState({ showColliders })} />\n          <Checkbox checked={state.isPaused}\n                    label=\"Pause\"\n                    hotkey=\"p\"\n                    onToggle={isPaused => this.setState({ isPaused })} />\n          <Checkbox checked={state.showZBuffer}\n                    label=\"Show z-buffer\"\n                    hotkey=\"z\"\n                    onToggle={showZBuffer => this.setState({ showZBuffer })} />\n          {!state.showZBuffer &&\n            <Checkbox checked={state.enableLighting}\n                      label=\"Enable lighting\"\n                      hotkey=\"l\"\n                      onToggle={enableLighting => this.setState({ enableLighting })} />}\n        </div>\n      </div>\n    );\n  }\n}\n","import { h, Component } from \"preact\";\n\ntype KeyboardMapHandler = () => void;\n\nexport class KeyboardMap {\n  mapping: Map<string, KeyboardMapHandler> = new Map();\n\n  constructor() {\n    document.body.addEventListener('keypress', e => this.handleEvent(e));\n  }\n\n  private handleEvent(e: KeyboardEvent) {\n    const handler = this.mapping.get(e.key.toLowerCase());\n    if (handler) {\n      handler();\n    }\n  }\n\n  set(key: string, handler: KeyboardMapHandler) {\n    this.mapping.set(key, handler);\n  }\n\n  unset(key: string) {\n    this.mapping.delete(key);\n  }\n}\n\nconst globalKeyboardMapping = new KeyboardMap();\n\ninterface HotkeyProps {\n  hotkey: string;\n  onPressed: KeyboardMapHandler;\n}\n\nexport class Hotkey extends Component<HotkeyProps> {\n  handlePress() {\n    this.props.onPressed();\n  }\n\n  componentDidMount() {\n    globalKeyboardMapping.set(this.props.hotkey, this.handlePress.bind(this));\n  }\n\n  componentWillUnmount() {\n    globalKeyboardMapping.unset(this.props.hotkey);\n  }\n\n  render(props: HotkeyProps) {\n    return <kbd>{props.hotkey}</kbd>;\n  }\n}\n","/**\n * Find an element.\n * \n * @param tagName The name of the element's HTML tag.\n * @param selector The selector for the element, not including its HTML tag.\n * @param parent The parent node to search within.\n */\nexport function getElement<K extends keyof HTMLElementTagNameMap>(\n  tagName: K,\n  selector: string,\n  parent: ParentNode = document\n): HTMLElementTagNameMap[K] {\n  const finalSelector = `${tagName}${selector}`;\n  const node = parent.querySelector(finalSelector);\n  if (!node) {\n    throw new Error(`Couldn't find any elements matching \"${finalSelector}\"`);\n  }\n  return node as HTMLElementTagNameMap[K];\n}\n","import { GlProgram, getAttribLocation, GlUniformMatrix3D, GlUniformBoolean, GlUniformVector3D } from \"./webgl\";\nimport { Points3DRenderer, Points3DRendererProgram } from \"./points-3d-renderer\";\nimport { Matrix3D, PerspectiveOptions } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\nimport { InvertibleTransforms3D } from \"./invertible-transforms-3d\";\nimport { makeSpaceship, makeGround, makeRayPoints, makeCircle } from \"./shapes\";\nimport { Point2D, screenCoordsToWorld, Dimensions2D } from \"./screen-space\";\nimport { Ray3D } from \"./ray-3d\";\nimport { getRaySphereIntersection } from \"./intersections\";\nimport { Points3D } from \"./points-3d\";\nimport { BLACK, Color } from \"./color\";\nimport { AppUiState } from \"./app-ui\";\n\nconst simpleVertexShaderSrc = require(\"./simple-vertex-shader.glsl\") as string;\nconst zBufferFragmentShaderSrc = require(\"./simple-fragment-shader.glsl\") as string;\n\nconst DRAW_RAY = false;\nconst PURPLE = Color.fromHex('#ed225d');\nconst BLUE = Color.fromHex('#2d7bb6');\n\nclass SimpleGlProgram extends GlProgram {\n  readonly projectionTransform: GlUniformMatrix3D;\n  readonly viewTransform: GlUniformMatrix3D;\n  readonly modelTransform: GlUniformMatrix3D;\n  readonly showZBuffer: GlUniformBoolean;\n  readonly color: GlUniformVector3D;\n  readonly light: GlUniformVector3D;\n  readonly normal: GlUniformVector3D;\n  readonly shade: GlUniformBoolean;\n  readonly positionAttributeLocation: number;\n\n  constructor(gl: WebGLRenderingContext) {\n    super(gl, simpleVertexShaderSrc, zBufferFragmentShaderSrc);\n    this.projectionTransform = new GlUniformMatrix3D(this, 'u_projection_transform');\n    this.viewTransform = new GlUniformMatrix3D(this, 'u_view_transform');\n    this.modelTransform = new GlUniformMatrix3D(this, 'u_model_transform');\n    this.color = new GlUniformVector3D(this, 'u_color');\n    this.light = new GlUniformVector3D(this, 'u_light');\n    this.normal = new GlUniformVector3D(this, 'u_normal');\n    this.shade = new GlUniformBoolean(this, 'u_shade');\n    this.positionAttributeLocation = getAttribLocation(gl, this.program, 'a_position');\n    this.showZBuffer = new GlUniformBoolean(this, 'u_show_z_buffer');\n  }\n}\n\ntype SpaceshipState = {\n  orbitTheta: number;\n  orbitThetaVelocity: number;\n  distanceFromCenter: number;\n  scale: number;\n  shipTheta: number;\n  shipThetaVelocity: number;\n  z: number;\n  color: Color;\n};\n\nclass Spaceship {\n  readonly state: Readonly<SpaceshipState>;\n\n  /** Model matrix to convert from object space to world space. */\n  readonly transform: Readonly<Matrix3D>;\n\n  /** The ship's surface normal, in object space. */\n  static readonly normal = new Vector3D(0, 0, 1);\n\n  private readonly colliderScale = 0.5;\n\n  constructor(state: SpaceshipState) {\n    this.state = state;\n\n    const transform = new Matrix3D()\n      .rotateZ(state.orbitTheta)\n      .translate(state.distanceFromCenter, 0, state.z)\n      .scale(state.scale)\n      .rotateY(state.shipTheta);\n\n    this.transform = transform;\n  }\n\n  static createRandom(props: Partial<SpaceshipState>) {\n    return new Spaceship({\n      orbitTheta: Math.random(),\n      orbitThetaVelocity: Math.random() * 0.01,\n      distanceFromCenter: Math.random(),\n      scale: 0.5,\n      shipTheta: Math.random(),\n      shipThetaVelocity: Math.random() * 0.05,\n      z: Math.random(),\n      color: PURPLE,\n      ...props\n    });\n  }\n\n  get colliderRadius(): number {\n    return this.state.scale * this.colliderScale;\n  }\n\n  /** Return a model matrix for the collider. */\n  getColliderTransform(): Matrix3D {\n    return this.transform.scale(this.colliderScale);\n  }\n\n  center(): Vector3D {\n    return this.transform.transformVector(new Vector3D());\n  }\n\n  doesRayIntersect(ray: Ray3D): boolean {\n    return getRaySphereIntersection(ray, this.center(), this.colliderRadius) !== null;\n  }\n\n  withColor(color: Color): Spaceship {\n    return new Spaceship({...this.state, color});\n  }\n\n  update(): Spaceship {\n    const { state } = this;\n    return new Spaceship({\n      ...state,\n      orbitTheta: state.orbitTheta + state.orbitThetaVelocity,\n      shipTheta: state.shipTheta + state.shipThetaVelocity,\n    });\n  }\n};\n\nfunction drawCollider(baseModelTransform: Matrix3D,\n                      modelTransformUniform: GlUniformMatrix3D,\n                      renderer: Points3DRenderer) {\n  const modelTransforms = [\n    baseModelTransform,\n    baseModelTransform.rotateX(Math.PI / 2),\n    baseModelTransform.rotateY(Math.PI / 2)\n  ];\n\n  modelTransforms.forEach(transform => {\n    modelTransformUniform.set(transform);\n    renderer.draw(WebGLRenderingContext.LINE_LOOP);\n  });\n}\n\nclass CameraRay {\n  readonly ray: Ray3D;\n  readonly points: Points3D;\n  readonly renderer: Points3DRenderer;\n\n  constructor(options: {\n    program: Points3DRendererProgram,\n    cameraTransform: InvertibleTransforms3D,\n    canvas: Dimensions2D,\n    coords: Point2D,\n    perspective: PerspectiveOptions,\n  }) {\n    const cameraPosition = options.cameraTransform.matrix.transformVector(new Vector3D());\n    const screenPointInWorld = screenCoordsToWorld(\n      options.canvas,\n      options.coords,\n      options.perspective,\n      options.cameraTransform.matrix\n    );\n    this.ray = Ray3D.fromTo(cameraPosition, screenPointInWorld);\n    this.points = makeRayPoints(this.ray);\n    this.renderer = new Points3DRenderer(options.program, this.points);\n  }\n}\n\ntype SceneState = {\n  perspective: PerspectiveOptions;\n  spaceships: Spaceship[];\n  cameraRotation: number;\n  ray?: CameraRay;\n};\n\nclass Scene {\n  /** Matrix to convert from eye space to clip coordinates. */\n  readonly projectionTransform: Matrix3D;\n\n  /** Matrix to move the camera from the origin to its position in world space. */\n  readonly cameraTransform: InvertibleTransforms3D;\n\n  /** Matrix to convert from world space to eye space. */\n  readonly viewTransform: Matrix3D;\n\n  constructor(readonly state: Readonly<SceneState>) {\n    this.projectionTransform = Matrix3D.perspectiveProjection(state.perspective);\n    this.cameraTransform = new InvertibleTransforms3D()\n      .rotateY(state.cameraRotation)\n      .translate(0, 0, 2.25);\n    this.viewTransform = this.cameraTransform.inverse();\n  }\n\n  update(): Scene {\n    const { state } = this;\n    return new Scene({\n      ...state,\n      cameraRotation: state.cameraRotation + 0.001,\n      spaceships: state.spaceships.map(ship => ship.update())\n    });\n  }\n\n  shootRay(ray: CameraRay): Scene {\n    const { state } = this;\n    return new Scene({\n      ...state,\n      spaceships: state.spaceships.map(\n        s => s.withColor(s.doesRayIntersect(ray.ray) ? BLUE : PURPLE)\n      ),\n      ray\n    });\n  }\n};\n\nfunction createRandomSpaceships(amount = 30) {\n  const spaceships: Spaceship[] = [];\n\n  for (let i = 0; i < amount; i++) {\n    spaceships.push(Spaceship.createRandom({\n      z: -1 + ((i / amount) * 2)\n    }));\n  }\n\n  return spaceships;\n}\n\ntype ClickAction = {\n  type: 'click';\n  point: Point2D;\n};\n\ntype TickAction = {\n  type: 'tick'\n};\n\ntype UiUpdateAction = {\n  type: 'uiupdate',\n  ui: AppUiState\n};\n\ntype AppAction = ClickAction|TickAction|UiUpdateAction;\n\ntype AppState = {\n  scene: Scene;\n  ui: AppUiState;\n}\n\nexport class App {\n  readonly gl: WebGLRenderingContext;\n  readonly program: SimpleGlProgram;\n  readonly spaceshipRenderer: Points3DRenderer;\n  readonly groundRenderer: Points3DRenderer;\n  readonly circleRenderer: Points3DRenderer;\n  private queuedActions: AppAction[] = [];\n  private ui: AppUiState = {\n    showColliders: false,\n    isPaused: false,\n    showZBuffer: true,\n    enableLighting: true\n  };\n\n  constructor(readonly canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl');\n\n    if (!gl) throw new Error(\"webgl is not supported on this browser!\");\n\n    this.gl = gl;\n\n    const program = new SimpleGlProgram(gl);\n    this.program = program;\n    this.spaceshipRenderer = new Points3DRenderer(program, makeSpaceship());\n    this.groundRenderer = new Points3DRenderer(program, makeGround());\n    this.circleRenderer = new Points3DRenderer(program, makeCircle());\n\n    canvas.addEventListener('click', (e) => {\n      if (this.ui.isPaused) return;\n      this.queuedActions.push({\n        type: 'click',\n        point: {x: e.offsetX, y: e.offsetY}\n      });\n    });\n  }\n\n  dispatchAction(action: AppAction) {\n    this.queuedActions.push(action);\n  }\n\n  getUi() {\n    return this.ui;\n  }\n\n  render({ scene, ui }: AppState) {\n    const { gl, program } = this;\n\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n    gl.enable(gl.DEPTH_TEST);\n    gl.clearColor(0, 0, 0, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    program.activate();\n    program.showZBuffer.set(ui.showZBuffer);\n    program.color.set(BLACK);\n    // Have the light be where the camera is.\n    program.light.set(scene.cameraTransform.matrix.transformVector(new Vector3D()));\n    program.projectionTransform.set(scene.projectionTransform);\n    program.viewTransform.set(scene.viewTransform);\n    program.shade.set(false);\n\n    if (scene.state.ray && DRAW_RAY) {\n      scene.state.ray.renderer.setupForDrawing();\n      // The ray is already in world coordinates.\n      program.modelTransform.set(new Matrix3D());\n      scene.state.ray.renderer.draw(gl.LINES);\n    }\n\n    this.groundRenderer.setupForDrawing();\n    // The ground is already in world coordinates.\n    program.modelTransform.set(new Matrix3D());\n    this.groundRenderer.draw(gl.LINES);\n\n    this.spaceshipRenderer.setupForDrawing();\n    program.shade.set(ui.enableLighting);\n    program.normal.set(Spaceship.normal);\n    scene.state.spaceships.forEach(spaceship => {\n      program.color.set(spaceship.state.color);\n      program.modelTransform.set(spaceship.transform);\n      this.spaceshipRenderer.draw();\n    });\n    program.shade.set(false);\n\n    if (ui.showColliders) {\n      this.circleRenderer.setupForDrawing();\n      scene.state.spaceships.forEach(spaceship => {\n        const transform = spaceship.getColliderTransform();\n        program.color.set(spaceship.state.color);\n        drawCollider(transform, program.modelTransform, this.circleRenderer);\n      });\n    }\n  }\n\n  processAction({ scene, ui }: AppState, action: AppAction): AppState {\n    switch (action.type) {\n      case 'click':\n      return { scene: scene.shootRay(new CameraRay({\n        coords: action.point,\n        program: this.program,\n        canvas: this.canvas,\n        cameraTransform: scene.cameraTransform,\n        perspective: scene.state.perspective\n      })), ui };\n\n      case 'tick':\n      return { scene: scene.update(), ui };\n\n      case 'uiupdate':\n      return { scene, ui: action.ui };\n    }\n  }\n\n  createInitialScene(): Scene {\n    return new Scene({\n      perspective: {\n        top: 1,\n        bottom: -1,\n        right: 1,\n        left: -1,\n        near: 1,\n        far: 4\n      },\n      spaceships: createRandomSpaceships(),\n      cameraRotation: 0\n    });\n  }\n\n  run() {\n    let state: AppState = {\n      scene: this.createInitialScene(),\n      ui: this.ui\n    };\n\n    const updateFrame = () => {\n      this.render(state);\n\n      const actions: AppAction[] = [...this.queuedActions];\n      this.queuedActions = [];\n\n      if (!state.ui.isPaused) {\n        actions.push({ type: 'tick' });\n      }\n\n      for (let action of actions) {\n        state = this.processAction(state, action);\n      }\n\n      window.requestAnimationFrame(updateFrame);\n    }\n\n    updateFrame();\n  }\n}\n","import { GlProgram, setupBuffer } from \"./webgl\";\nimport { Points3D } from \"./points-3d\";\n\nexport interface Points3DRendererProgram extends GlProgram {\n  positionAttributeLocation: number;\n}\n\nexport class Points3DRenderer {\n  buffer: WebGLBuffer;\n\n  constructor(readonly program: Points3DRendererProgram, readonly points: Points3D) {\n    const { gl } = program;\n    this.buffer = setupBuffer(gl, points.toFloat32Array());\n  }\n\n  setupForDrawing() {\n    const { gl, positionAttributeLocation } = this.program;\n\n    gl.enableVertexAttribArray(positionAttributeLocation);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n\n    const vertexSize = 3;\n    const type = gl.FLOAT;\n    const normalize = false;\n    const stride = 0;\n    const offset = 0;\n    gl.vertexAttribPointer(positionAttributeLocation, vertexSize, type, normalize, stride, offset);\n  }\n\n  draw(primitiveType: number = WebGLRenderingContext.TRIANGLES) {\n    const { gl } = this.program;\n    const drawOffset = 0;\n    const count = this.points.length;\n    gl.drawArrays(primitiveType, drawOffset, count);  \n  }\n}\n","import { Matrix3D } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\ntype InvertOp = (m: Matrix3D) => Matrix3D;\n\n/**\n * A class that keeps track of simple 3D transformations made to it, so\n * its inverse can be easily computed.\n * \n * I originally thought this idea was too silly to use in practice, but\n * it's actually documented in Real-Time Rendering, 4th edition,\n * section 4.1.8 (page 69) as a perfectly valid way to invert many\n * kinds of matrices we're interested in.\n */\nexport class InvertibleTransforms3D {\n  constructor(readonly matrix: Matrix3D = new Matrix3D(), private ops: InvertOp[] = []) {\n  }\n\n  private addOp(matrix: Matrix3D, op: InvertOp): InvertibleTransforms3D {\n    return new InvertibleTransforms3D(matrix, [op, ...this.ops]);\n  }\n\n  translate(v: Vector3D): InvertibleTransforms3D;\n  translate(x: number, y: number, z: number): InvertibleTransforms3D;\n\n  translate(x: Vector3D|number, y?: number, z?: number): InvertibleTransforms3D {\n    const vector = Vector3D.fromVectorOrCoords(x, y, z);\n\n    return this.addOp(\n      this.matrix.translate(vector),\n      m => m.translate(vector.times(-1))\n    );\n  }\n\n  /** Rotate counter-clockwise around the X axis. */\n  rotateX(radians: number) {\n    return this.addOp(\n      this.matrix.rotateX(radians),\n      m => m.rotateX(-radians)\n    );\n  }\n\n  /** Rotate counter-clockwise around the Y axis. */\n  rotateY(radians: number) {\n    return this.addOp(\n      this.matrix.rotateY(radians),\n      m => m.rotateY(-radians)\n    );\n  }\n\n  /** Rotate counter-clockwise around the Z axis. */\n  rotateZ(radians: number) {\n    return this.addOp(\n      this.matrix.rotateZ(radians),\n      m => m.rotateZ(-radians)\n    );\n  }\n\n  /** Return the inverse of the matrix. */\n  inverse(): Matrix3D {\n    let matrix = new Matrix3D();\n\n    for (let inverseOp of this.ops) {\n      matrix = inverseOp(matrix);\n    }\n\n    return matrix;\n  }\n}\n","import { Points3D } from \"./points-3d\";\nimport { Vector3D } from \"./vector-3d\";\nimport { Ray3D } from \"./ray-3d\";\nimport { Matrix3D } from \"./matrix-3d\";\n\nexport function makeSpaceship(): Points3D {\n  const translate = new Matrix3D().translate(0, -0.25, 0);\n  const mirror = new Matrix3D().scale(-1, 1, 1);\n  const leftHalf = translate.transformPoints(Points3D.fromArray([\n    -0.5, 0, 0,\n    0, 0.75, 0,\n    0, 0.15, 0\n  ]));\n\n  return leftHalf.concat(mirror.transformPoints(leftHalf));\n}\n\nexport function makeGround(y = -1, xzStart = -1, size = 2, pointsPerAxis = 20): Points3D {\n  const points: number[] = [];\n  let xPart = xzStart;\n  let zPart = xzStart;\n  let partInc = 1 / pointsPerAxis;\n\n  for (let i = 0; i <= pointsPerAxis; i++) {\n    points.push(xPart, y, zPart);\n    points.push(xPart, y, zPart + size);\n    xPart += size * partInc;\n  }\n\n  xPart = xzStart;\n  for (let i = 0; i <= pointsPerAxis; i++) {\n    points.push(xPart, y, zPart);\n    points.push(xPart + size, y, zPart);\n    zPart += size * partInc;\n  }\n\n  return Points3D.fromArray(points);\n}\n\nexport function makeRayPoints(ray: Ray3D, segments = 1, length = 5): Points3D {\n  let point = ray.origin;\n  const increment = ray.direction.times(length / segments);\n  const points: number[] = [];\n\n  for (let i = 0; i < segments; i++) {\n    points.push(point.x, point.y, point.z);\n    point = point.plus(increment);\n    points.push(point.x, point.y, point.z);\n  }\n\n  return Points3D.fromArray(points);\n}\n\nexport function makeCircle(segments = 20): Points3D {\n  const points: number[] = [];\n  const start = new Vector3D(1, 0, 0);\n\n  for (let i = 0; i < segments; i++) {\n    const rotation = new Matrix3D().rotateZ(2 * Math.PI * (i / segments));\n    const p = rotation.transformVector(start);\n    points.push(p.x, p.y, p.z);\n  }\n\n  return Points3D.fromArray(points);\n}\n","import { Vector3D } from \"./vector-3d\";\n\nexport class Points3D {\n  constructor(private readonly array: Vector3D[]) {\n  }\n\n  toFloat32Array(): Float32Array {\n    const { array } = this;\n    const result = new Float32Array(array.length * 3);\n    let arrIndex = 0;\n\n    for (let i = 0; i < result.length; i += 3) {\n      result[i] = array[arrIndex].x;\n      result[i + 1] = array[arrIndex].y;\n      result[i + 2] = array[arrIndex].z;\n      arrIndex += 1;\n    }\n\n    return result;\n  }\n\n  concat(points: Points3D): Points3D {\n    const combined = this.array.concat(points.array);\n    return new Points3D(combined);\n  }\n\n  map(fn: (v: Vector3D) => Vector3D) {\n    return new Points3D(this.array.map(fn));\n  }\n\n  get length(): number {\n    return this.array.length;\n  }\n\n  static fromArray(array: number[]|Float32Array) {\n    const numPoints = array.length / 3;\n    const pointArray = new Array<Vector3D>(numPoints);\n    let arrIndex = 0;\n    for (let i = 0; i < numPoints; i++) {\n      const x = array[arrIndex];\n      const y = array[arrIndex + 1];\n      const z = array[arrIndex + 2];\n      pointArray[i] = new Vector3D(x, y, z);\n      arrIndex += 3;\n    }\n    return new Points3D(pointArray);\n  }\n}\n","import { PerspectiveOptions, Matrix3D } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\nexport type Point2D = {\n  x: number,\n  y: number\n};\n\nexport type Dimensions2D = {\n  width: number,\n  height: number\n};\n\n/**\n * Convert the given screen coordinates, in pixels, to\n * eye coordinates (from the perspective of the camera).\n */\nfunction screenCoordsToEye(canvas: Dimensions2D, point: Point2D, perspective: PerspectiveOptions): Vector3D {\n  const width = perspective.right - perspective.left;\n  const height = perspective.top - perspective.bottom;\n  const xPct = (point.x / canvas.width);\n  // Note that we need to flip the y-axis.\n  const yPct = ((canvas.height - point.y) / canvas.height);\n\n  const x = perspective.left + xPct * width;\n  const y = perspective.bottom + yPct * height;\n\n  // We need to flip the near value because it's specified in\n  // clip coordinates.\n  const z = -perspective.near;\n\n  return new Vector3D(x, y, z);\n}\n\n/**\n * Convert the given pixel coordinates on the given canvas to\n * points in the world.\n */\nexport function screenCoordsToWorld(\n  canvas: Dimensions2D,\n  point: Point2D,\n  perspective: PerspectiveOptions,\n  cameraTransform: Matrix3D\n): Vector3D {\n  const pointRelativeToCamera = screenCoordsToEye(canvas, point, perspective);\n  return cameraTransform.transformVector(pointRelativeToCamera);\n}\n","import { Vector3D } from \"./vector-3d\";\n\n/**\n * An abstraction for a normalized ray that emanates\n * from an origin in a direction.\n */\nexport class Ray3D {\n  readonly direction: Vector3D;\n\n  constructor(readonly origin: Vector3D, direction: Vector3D) {\n    this.direction = direction.normalize();\n  }\n\n  pointAlong(t: number): Vector3D {\n    return this.origin.plus(this.direction.times(t));\n  }\n\n  static fromTo(from: Vector3D, to: Vector3D): Ray3D {\n    const direction = to.minus(from);\n    return new Ray3D(from, direction);\n  }\n}\n","import { Vector3D } from \"./vector-3d\";\nimport { Ray3D } from \"./ray-3d\";\n\n/**\n * Tests for ray/sphere intersection, returning null if the\n * ray never intersects with the sphere, or the vector\n * representing the closest point of intersection.\n * \n * Derivation for this can be found in Real-Time Rendering,\n * 4th edition, 22.6.1 (page 956).\n */\nexport function getRaySphereIntersection(ray: Ray3D, center: Vector3D, radius: number): null | Vector3D {\n  const originMinusCenter = ray.origin.minus(center);\n  const b = ray.direction.dot(originMinusCenter);\n  const c = originMinusCenter.dot(originMinusCenter) - radius * radius;\n  const bSquaredMinusC = b * b - c;\n\n  if (bSquaredMinusC < 0) {\n    return null;\n  }\n\n  const sqrt = Math.sqrt(bSquaredMinusC);\n  const t = [-b + sqrt, -b - sqrt].filter(value => value >= 0);\n  if (t.length === 0) {\n    return null;\n  }\n\n  const closestT = t.sort((a, b) => a - b)[0];\n  return ray.pointAlong(closestT);\n}\n","import { Vector3D } from \"./vector-3d\";\n\nexport class Color extends Vector3D {\n  constructor(\n    red: number,\n    green: number,\n    blue: number,\n    alpha: number = 1.0  \n  ) {\n    super(red, green, blue, alpha);\n  }\n\n  static fromHex(hex: string): Color {\n    hex = hex.toLowerCase();\n\n    if (hex[0] == '#') {\n      hex = hex.slice(1);\n    }\n\n    const toFloat = (hex: string) => parseInt(hex, 16) / 255;\n\n    const red = toFloat(hex.substr(0, 2));\n    const green = toFloat(hex.substr(2, 2));\n    const blue = toFloat(hex.substr(4, 2));\n\n    return new Color(red, green, blue);\n  }\n}\n\nexport const BLACK = new Color(0, 0, 0);\n","module.exports = \"precision mediump float;\\n\\n/**\\n * Attributes\\n *\\n * These are passed into us and generally change\\n * from one execution of our shader program to the next\\n * during a render call.\\n */\\n\\n/** The position of the vertex, in object space. */\\nattribute vec4 a_position;\\n\\n/**\\n * Uniforms\\n *\\n * These are passed into us and do not change from\\n * one execution of our shader program to the next\\n * during a render call.\\n */\\n\\n/** The color of the vertex. */\\nuniform vec4 u_color;\\n\\n/** The vertex's normal in object space. */\\nuniform vec4 u_normal;\\n\\n/** The position of the light in world coordinates. */\\nuniform vec4 u_light;\\n\\n/**\\n * Whether or not to actually shade the vertex based on\\n * the current lighting.\\n */\\nuniform bool u_shade;\\n\\n/** Matrix to convert from eye space to clip coordinates. */\\nuniform mat4 u_projection_transform;\\n\\n/** Matrix to convert from world space to eye space. */\\nuniform mat4 u_view_transform;\\n\\n/** Matrix to convert from object space to world space. */\\nuniform mat4 u_model_transform;\\n\\n/**\\n * Varyings\\n *\\n * These are passed from us to the fragment shader.\\n */\\n\\n/** The color of the vertex. */\\nvarying vec4 v_color;\\n\\nvoid main() {\\n  gl_Position = u_projection_transform * u_view_transform * u_model_transform * a_position;\\n\\n  float light_amount = 1.0;\\n\\n  if (u_shade) {\\n    float ambient_light_amount = 0.25;\\n    float max_illumination = 1.0 - ambient_light_amount;\\n\\n    // The surface normal, in world space.\\n    vec4 world_normal = normalize(\\n      u_model_transform * u_normal -\\n      u_model_transform * vec4(0, 0, 0, 1)\\n    );\\n\\n    // The direction from the origin to the light source, in world space.\\n    vec4 world_light = normalize(u_light);\\n\\n    // Based on the angle between the surface normal and the\\n    // light, shade the vertex accordingly.\\n    //\\n    // Note that we're taking the absolute value of the dot\\n    // product because we're assuming that the shape we're\\n    // drawing is two-sided, and that the side of the shape\\n    // visible to the user is also the side that faces the\\n    // light.\\n    float illumination = abs(dot(world_normal, world_light));\\n\\n    light_amount = ambient_light_amount + illumination * max_illumination;\\n  }\\n\\n  v_color = vec4(light_amount * vec3(u_color), 1.0);\\n}\\n\";","module.exports = \"precision mediump float;\\n\\n/**\\n * Uniforms\\n *\\n * These are passed into us and do not change from\\n * one execution of our shader program to the next\\n * during a render call.\\n */\\n\\n/** Whether to color the fragment based on its z-buffer location. */\\nuniform bool u_show_z_buffer;\\n\\n/**\\n * Varyings\\n *\\n * These are passed into us from the vertex shader.\\n */\\n\\n/** The color of the fragment. */\\nvarying vec4 v_color;\\n\\nvoid main() {\\n  if (u_show_z_buffer) {\\n    // This essentially visualizes the z-buffer. Taken from:\\n    //\\n    //   https://learnopengl.com/Advanced-OpenGL/Depth-testing\\n    gl_FragColor = vec4(vec3(gl_FragCoord.z), 1.0);\\n  } else {\\n    gl_FragColor = v_color;\\n  }\\n}\\n\";"],"sourceRoot":""}