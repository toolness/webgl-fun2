{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/vector-3d.ts","webpack:///./src/matrix-3d.ts","webpack:///./src/app.ts","webpack:///./src/webgl.ts","webpack:///./src/points-3d-renderer.ts","webpack:///./src/invertible-transforms-3d.ts","webpack:///./src/shapes.ts","webpack:///./src/points-3d.ts","webpack:///./src/screen-space.ts","webpack:///./src/checkable-value.ts","webpack:///./src/simple-vertex-shader.glsl","webpack:///./src/z-buffer-fragment-shader.glsl"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Vector3D","[object Object]","x","y","z","w","this","v","len","Math","sqrt","vector_3d_1","IDENTITY","Matrix3D","values","valueAt","Float32Array","row","column","fromVectorOrCoords","multiply","radians","cos","sin","m2","col1","transformVector","col2","col3","col4","f","map","options","near","far","left","right","top","bottom","width","height","depth","doubleNear","col","webgl_1","points_3d_renderer_1","matrix_3d_1","invertible_transforms_3d_1","shapes_1","screen_space_1","checkable_value_1","simpleVertexShaderSrc","zBufferFragmentShaderSrc","Spaceship","orbitTheta","random","orbitThetaVelocity","distanceFromCenter","scale","shipTheta","shipThetaVelocity","window","addEventListener","canvas","document","createElement","body","appendChild","style","border","gl","getContext","Error","program","GlProgram","super","transform","GlUniformMatrix3D","positionAttributeLocation","getAttribLocation","spaceshipRenderer","Points3DRenderer","makeSpaceship","groundRenderer","makeGround","rayRenderer","perspective","baseProjectionTransform","perspectiveProjection","spaceships","screenClick","CheckableValue","push","onclick","e","set","offsetX","offsetY","console","log","cameraRotation","render","cameraTransform","InvertibleTransforms3D","rotateY","translate","viewTransform","inverse","projectionTransform","check","coords","cameraPosition","matrix","getCameraPosition","ray","screenCoordsToWorld","minus","makeRay","viewport","enable","DEPTH_TEST","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","activate","setupForDrawing","draw","LINES","forEach","spaceship","baseTransform","rotateZ","update","requestAnimationFrame","createShader","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","msg","getShaderInfoLog","deleteShader","loc","vertexShaderSrc","fragmentShaderSrc","vertexShader","WebGLRenderingContext","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","GlUniformBase","location","getUniformLocation","GlUniformVector","uniform4fv","GlUniformFloat","uniform1f","uniformMatrix4fv","toFloat32Array","points","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","FLOAT","vertexAttribPointer","primitiveType","TRIANGLES","count","length","drawArrays","ops","op","vector","addOp","times","rotateX","inverseOp","points_3d_1","leftHalf","Points3D","fromArray","concat","mirrorHorizontally","xzStart","size","pointsPerAxis","xPart","zPart","partInc","start","segments","point","increment","normalize","plus","array","result","arrIndex","combined","numPoints","pointArray","Array","pointRelativeToCamera","xPct","yPct","screenCoordsToEye","lastCheckedValue","cb"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/**\n * A three-dimensional vector. Note that it actually has\n * four elements because we use a homogeneous coordinate\n * system.\n */\nexport class Vector3D {\n  constructor(readonly x: number, readonly y: number, readonly z: number, readonly w: number = 1.0) {\n  }\n\n  perspectiveDivide(): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x / w, y / w, z / w);\n  }\n\n  minus(v: Vector3D): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x - v.x, y - v.y, z - v.z, w);\n  }\n\n  plus(v: Vector3D): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x + v.x, y + v.y, z + v.z, w);\n  }\n\n  times(n: number): Vector3D {\n    const { x, y, z, w } = this;\n    return new Vector3D(x * n, y * n, z * n, w);\n  }\n\n  normalize(): Vector3D {\n    const { x, y, z, w } = this;\n    const len = Math.sqrt(x * x + y * y + z * z);\n    return new Vector3D(x / len, y / len, z / len, w);\n  }\n\n  /**\n   * A helper to convert either a vector or a sequence of coordinates\n   * into a vector.\n   */\n  static fromVectorOrCoords(x: Vector3D | number, y?: number, z?: number): Vector3D {\n    z = x instanceof Vector3D ? x.z : z || 0;\n    y = x instanceof Vector3D ? x.y : y || 0;\n    x = x instanceof Vector3D ? x.x : x;\n    return new Vector3D(x, y, z);\n  }\n}","import { Vector3D } from \"./vector-3d\";\n\ntype Column = 1|2|3|4;\ntype Row = 1|2|3|4;\n\n/**\n * A 4x4 matrix represented as\n * a two-dimensional array in\n * row-major order.\n */\ntype Matrix3DTuple = [\n  [number, number, number, number],\n  [number, number, number, number],\n  [number, number, number, number],\n  [number, number, number, number]\n];\n\nexport type PerspectiveOptions = {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n  near: number;\n  far: number;\n};\n\nconst IDENTITY: Matrix3DTuple = [\n  [1, 0, 0, 0],\n  [0, 1, 0, 0],\n  [0, 0, 1, 0],\n  [0, 0, 0, 1]\n];\n\n/**\n * A three-dimensional matrix. Note that it ultimately represents a 4x4\n * matrix because we use homogeneous coordinates.\n */\nexport class Matrix3D {\n  constructor(readonly values: Matrix3DTuple = IDENTITY) {\n    this.valueAt = this.valueAt.bind(this);\n  }\n\n  /**\n   * Convert the matrix into a Float32Array in column-major order\n   * (the layout that GLSL expects).\n   */\n  toFloat32Array(): Float32Array {\n    const m = this.valueAt;\n    return new Float32Array([\n      m(1, 1), m(2, 1), m(3, 1), m(4, 1),\n      m(1, 2), m(2, 2), m(3, 2), m(4, 2),\n      m(1, 3), m(2, 3), m(3, 3), m(4, 3),\n      m(1, 4), m(2, 4), m(3, 4), m(4, 4),\n    ]);\n  }\n\n  valueAt(row: Row, column: Column): number {\n    return this.values[row - 1][column - 1];\n  }\n\n  translate(v: Vector3D): Matrix3D;\n  translate(x: number, y: number, z: number): Matrix3D;\n\n  translate(x: Vector3D|number, y?: number, z?: number): Matrix3D {\n    const v = Vector3D.fromVectorOrCoords(x, y, z);\n\n    return this.multiply(new Matrix3D([\n      [1, 0, 0, v.x],\n      [0, 1, 0, v.y],\n      [0, 0, 1, v.z],\n      [0, 0, 0,   1]\n    ]));\n  }\n\n  scale(v: number) {\n    return this.multiply(new Matrix3D([\n      [v, 0, 0, 0],\n      [0, v, 0, 0],\n      [0, 0, v, 0],\n      [0, 0, 0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the X axis. */\n  rotateX(radians: number) {\n    // Deriving this requires the trigonometric identities for angle sums:\n    //\n    //   https://en.wikipedia.org/wiki/List_of_trigonometric_identities\n    //\n    // That said, I think an alternative approach is to think of rotation\n    // as transformation of basis vectors via matrix multiplication,\n    // which simplifies things conceptually.\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [1,  0, 0, 0],\n      [0,  c, s, 0],\n      [0, -s, c, 0],\n      [0,  0, 0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the Y axis. */\n  rotateY(radians: number) {\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [c, 0, -s, 0],\n      [0, 1,  0, 0],\n      [s, 0,  c, 0],\n      [0, 0,  0, 1]\n    ]));\n  }\n\n  /** Rotate counter-clockwise around the Z axis. */\n  rotateZ(radians: number) {\n    const c = Math.cos(radians);\n    const s = Math.sin(radians);\n    return this.multiply(new Matrix3D([\n      [c, -s, 0, 0],\n      [s,  c, 0, 0],\n      [0,  0, 1, 0],\n      [0,  0, 0, 1]\n    ]));\n  }\n\n  multiply(m2: Matrix3D): Matrix3D {\n    // Conceptualy, it's easiest to think of matrix multiplication\n    // as a transformation of a coordinate system's basis\n    // vectors:\n    //\n    //   http://www.3blue1brown.com/essence-of-linear-algebra-page/\n    //\n    // This isn't particularly efficient code, but hopefully\n    // it is readable.\n    const col1 = this.transformVector(m2.column(1));\n    const col2 = this.transformVector(m2.column(2));\n    const col3 = this.transformVector(m2.column(3));\n    const col4 = this.transformVector(m2.column(4));\n    return new Matrix3D([\n      [col1.x, col2.x, col3.x, col4.x],\n      [col1.y, col2.y, col3.y, col4.y],\n      [col1.z, col2.z, col3.z, col4.z],\n      [col1.w, col2.w, col3.w, col4.w],\n    ]);\n  }\n\n  /**\n   * Apply the given function to every element of the matrix, returning\n   * a new one.\n   */\n  map(f: (value: number) => number): Matrix3D {\n    return new Matrix3D(this.values.map(row => row.map(f)) as Matrix3DTuple);\n  }\n\n  /**\n   * Multiply all elements of the matrix by the given constant,\n   * returning a new matrix.\n   */\n  multiplyByConstant(n: number): Matrix3D {\n    return this.map(value => value * n);\n  }\n\n  /**\n   * Create a matrix that transforms eye coordinates into clip\n   * coordinates.\n   * \n   * Note that clip coordinates will likely have a w-component\n   * that is not 1; the GPU will perform a perspective divide\n   * after the vertex shader to convert the clip coordinates\n   * into normalized device coordinates (NDC).\n   * \n   * Note also that the near and far parameters must be\n   * specified as positive numbers, as the clip coordinates\n   * use a left-handed coordinate system, while the\n   * eye coordinates use a right-handed coordinate system,\n   * and the projection matrix will convert between the\n   * two.\n   * \n   * For more details, as well as an excellent derivation\n   * of all the math behind all this, see:\n   * \n   *   http://www.songho.ca/opengl/gl_projectionmatrix.html#perspective\n   */\n  static perspectiveProjection(options: PerspectiveOptions): Matrix3D {\n    const { near, far, left, right, top, bottom } = options;\n    const width = right - left;\n    const height = top - bottom;\n    const depth = far - near;\n    const doubleNear = 2 * near;\n    return new Matrix3D([\n      [doubleNear / width, 0, (right + left) / width, 0],\n      [0, doubleNear / height, (top + bottom) / height, 0],\n      [0, 0, -(far + near) / depth, -2 * far * near / depth],\n      [0, 0, -1, 0]\n    ]);\n  }\n\n  transformVector(v: Vector3D): Vector3D {\n    const m = this.valueAt;\n    return new Vector3D(\n      m(1, 1) * v.x + m(1, 2) * v.y + m(1, 3) * v.z + m(1, 4) * v.w,\n      m(2, 1) * v.x + m(2, 2) * v.y + m(2, 3) * v.z + m(2, 4) * v.w,\n      m(3, 1) * v.x + m(3, 2) * v.y + m(3, 3) * v.z + m(3, 4) * v.w,\n      m(4, 1) * v.x + m(4, 2) * v.y + m(4, 3) * v.z + m(4, 4) * v.w,\n    );\n  }\n\n  column(col: Column): Vector3D {\n    const m = this.valueAt;\n    return new Vector3D(\n      m(1, col),\n      m(2, col),\n      m(3, col),\n      m(4, col)\n    );\n  }\n}\n","import { GlProgram, getAttribLocation, GlUniformMatrix3D } from \"./webgl\";\nimport { Points3DRenderer } from \"./points-3d-renderer\";\nimport { Matrix3D, PerspectiveOptions } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\nimport { InvertibleTransforms3D } from \"./invertible-transforms-3d\";\nimport { makeSpaceship, makeGround, makeRay } from \"./shapes\";\nimport { Point2D, screenCoordsToWorld } from \"./screen-space\";\nimport { CheckableValue } from \"./checkable-value\";\n\nconst simpleVertexShaderSrc = require(\"./simple-vertex-shader.glsl\") as string;\nconst zBufferFragmentShaderSrc = require(\"./z-buffer-fragment-shader.glsl\") as string;\n\nclass SimpleGlProgram extends GlProgram {\n  readonly transform: GlUniformMatrix3D;\n  readonly positionAttributeLocation: number;\n\n  constructor(gl: WebGLRenderingContext) {\n    super(gl, simpleVertexShaderSrc, zBufferFragmentShaderSrc);\n    this.transform = new GlUniformMatrix3D(this, 'u_transform');\n    this.positionAttributeLocation = getAttribLocation(gl, this.program, 'a_position');\n  }\n}\n\nclass Spaceship {\n  orbitTheta = Math.random();\n  orbitThetaVelocity = Math.random() * 0.01;\n  distanceFromCenter = Math.random();\n  scale = 0.5;\n  shipTheta = Math.random();\n  shipThetaVelocity = Math.random() * 0.05;\n\n  constructor(readonly z: number) {\n  }\n\n  update() {\n    this.orbitTheta += this.orbitThetaVelocity;\n    this.shipTheta += this.shipThetaVelocity;\n  }\n};\n\nfunction getCameraPosition(cameraTransform: InvertibleTransforms3D): Vector3D {\n  return cameraTransform.matrix.transformVector(new Vector3D(0, 0, 0));\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  const canvas = document.createElement('canvas');\n\n  document.body.appendChild(canvas);\n  canvas.width = 800;\n  canvas.height = 800;\n  canvas.style.border = '1px solid black';\n\n  const gl = canvas.getContext('webgl');\n  if (!gl) throw new Error(\"webgl is not supported on this browser!\");\n\n  const program = new SimpleGlProgram(gl);\n  const spaceshipRenderer = new Points3DRenderer(program, makeSpaceship());\n  const groundRenderer = new Points3DRenderer(program, makeGround());\n  let rayRenderer: Points3DRenderer|null = null;\n  const perspective: PerspectiveOptions = {\n    top: 1,\n    bottom: -1,\n    right: 1,\n    left: -1,\n    near: 1,\n    far: 3\n  };\n  const baseProjectionTransform = Matrix3D.perspectiveProjection(perspective);\n  const spaceships: Spaceship[] = [];\n  const NUM_SPACESHIPS = 30;\n  let screenClick = new CheckableValue<Point2D>();\n\n  for (let i = 0; i < NUM_SPACESHIPS; i++) {\n    spaceships.push(new Spaceship(-1 + ((i / NUM_SPACESHIPS) * 2)));\n  }\n\n  canvas.onclick = (e) => { screenClick.set({x: e.offsetX, y: e.offsetY}); };\n\n  console.log(\"Initialization successful!\");\n\n  let cameraRotation = 0;\n\n  const render = () => {\n    const cameraTransform = new InvertibleTransforms3D()\n      .rotateY(cameraRotation)\n      .translate(0, 0, 2.25);\n    const viewTransform = cameraTransform.inverse();\n    const projectionTransform = baseProjectionTransform.multiply(viewTransform);\n\n    screenClick.check(coords => {\n      const cameraPosition = getCameraPosition(cameraTransform);\n      const screenPointInWorld = screenCoordsToWorld(\n        canvas,\n        coords,\n        perspective,\n        cameraTransform.matrix\n      );\n      const ray = screenPointInWorld.minus(cameraPosition);\n\n      rayRenderer = new Points3DRenderer(program, makeRay(cameraPosition, ray));\n    });\n\n    cameraRotation += 0.001;\n\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n    gl.enable(gl.DEPTH_TEST);\n    gl.clearColor(0, 0, 0, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    program.activate();\n    if (rayRenderer) {\n      rayRenderer.setupForDrawing();\n      program.transform.set(projectionTransform);\n      rayRenderer.draw(gl.LINES);\n    }\n    groundRenderer.setupForDrawing();\n    program.transform.set(projectionTransform);\n    groundRenderer.draw(gl.LINES);\n    spaceshipRenderer.setupForDrawing();\n    spaceships.forEach(spaceship => {\n      const baseTransform = new Matrix3D()\n        .rotateZ(spaceship.orbitTheta)\n        .translate(spaceship.distanceFromCenter, 0, spaceship.z)\n        .scale(spaceship.scale)\n        .rotateY(spaceship.shipTheta);\n      program.transform.set(projectionTransform.multiply(baseTransform));\n      spaceshipRenderer.draw();\n      spaceship.update();\n    });\n    window.requestAnimationFrame(render);\n  };\n\n  render();\n});\n","import { Matrix3D } from \"./matrix-3d\";\n\nfunction createShader(gl: WebGLRenderingContext, type: number, source: string): WebGLShader {\n  const shader = gl.createShader(type);\n  if (!shader) throw new Error(\"gl.createShader() failed!\");\n\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n  if (!success) {\n    const msg = \"Compiling shader failed: \" + gl.getShaderInfoLog(shader);\n    gl.deleteShader(shader);\n    throw new Error(msg);\n  }\n\n  return shader;\n}\n\nfunction createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n  const program = gl.createProgram();\n  if (!program) throw new Error(\"gl.createProgram() failed!\");\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (!success) {\n    const msg = \"Linking program failed: \" + gl.getProgramInfoLog(program);\n    gl.deleteProgram(program);\n    throw new Error(msg);\n  }\n\n  return program;\n}\n\nfunction getUniformLocation(gl: WebGLRenderingContext, program: WebGLProgram, name: string): WebGLUniformLocation {\n  const loc = gl.getUniformLocation(program, name);\n\n  if (loc === null) {\n    throw new Error(`Unable to find uniform '${name}'!`);\n  }\n\n  return loc;\n}\n\nexport function getAttribLocation(gl: WebGLRenderingContext, program: WebGLProgram, name: string): number {\n  const loc = gl.getAttribLocation(program, name);\n\n  if (loc === -1) {\n    throw new Error(`Unable to find attribute '${name}'!`);\n  }\n\n  return loc;\n}\n\nexport class GlProgram {\n  readonly program: WebGLProgram;\n\n  constructor(readonly gl: WebGLRenderingContext, vertexShaderSrc: string, fragmentShaderSrc: string) {\n    const vertexShader = createShader(gl, WebGLRenderingContext.VERTEX_SHADER, vertexShaderSrc);\n    const fragmentShader = createShader(gl, WebGLRenderingContext.FRAGMENT_SHADER, fragmentShaderSrc);\n    this.program = createProgram(gl, vertexShader, fragmentShader);\n  }\n\n  activate() {\n    this.gl.useProgram(this.program);\n  }\n}\n\nclass GlUniformBase {\n  location: WebGLUniformLocation;\n\n  constructor(readonly program: GlProgram, name: string) {\n    this.location = getUniformLocation(program.gl, program.program, name);\n  }\n}\n\nexport class GlUniformVector extends GlUniformBase {\n  set(value: Float32List) {\n    this.program.gl.uniform4fv(this.location, value);\n  }\n}\n\nexport class GlUniformFloat extends GlUniformBase {\n  set(value: number) {\n    this.program.gl.uniform1f(this.location, value);\n  }\n}\n\nexport class GlUniformMatrix3D extends GlUniformBase {\n  set(value: Matrix3D) {\n    this.program.gl.uniformMatrix4fv(this.location, false, value.toFloat32Array());\n  }\n}\n","import { GlProgram } from \"./webgl\";\nimport { Points3D } from \"./points-3d\";\n\nexport interface Points3DRendererProgram extends GlProgram {\n  positionAttributeLocation: number;\n}\n\nexport class Points3DRenderer {\n  buffer: WebGLBuffer;\n\n  constructor(readonly program: Points3DRendererProgram, readonly points: Points3D) {\n    const { gl } = program;\n    const buffer = gl.createBuffer();\n\n    if (buffer === null) {\n      throw new Error(\"gl.createBuffer() failed!\");\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, points.toFloat32Array(), gl.STATIC_DRAW);\n\n    this.buffer = buffer;\n  }\n\n  setupForDrawing() {\n    const { gl, positionAttributeLocation } = this.program;\n\n    gl.enableVertexAttribArray(positionAttributeLocation);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n\n    const vertexSize = 3;\n    const type = gl.FLOAT;\n    const normalize = false;\n    const stride = 0;\n    const offset = 0;\n    gl.vertexAttribPointer(positionAttributeLocation, vertexSize, type, normalize, stride, offset);\n  }\n\n  draw(primitiveType: number = WebGLRenderingContext.TRIANGLES) {\n    const { gl } = this.program;\n    const drawOffset = 0;\n    const count = this.points.length;\n    gl.drawArrays(primitiveType, drawOffset, count);  \n  }\n}\n","import { Matrix3D } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\ntype InvertOp = (m: Matrix3D) => Matrix3D;\n\n/**\n * A class that keeps track of simple 3D transformations made to it, so\n * its inverse can be easily computed.\n * \n * I originally thought this idea was too silly to use in practice, but\n * it's actually documented in Real-Time Rendering, 4th edition,\n * section 4.1.8 (page 69) as a perfectly valid way to invert many\n * kinds of matrices we're interested in.\n */\nexport class InvertibleTransforms3D {\n  constructor(readonly matrix: Matrix3D = new Matrix3D(), private ops: InvertOp[] = []) {\n  }\n\n  private addOp(matrix: Matrix3D, op: InvertOp): InvertibleTransforms3D {\n    return new InvertibleTransforms3D(matrix, [op, ...this.ops]);\n  }\n\n  translate(v: Vector3D): InvertibleTransforms3D;\n  translate(x: number, y: number, z: number): InvertibleTransforms3D;\n\n  translate(x: Vector3D|number, y?: number, z?: number): InvertibleTransforms3D {\n    const vector = Vector3D.fromVectorOrCoords(x, y, z);\n\n    return this.addOp(\n      this.matrix.translate(vector),\n      m => m.translate(vector.times(-1))\n    );\n  }\n\n  /** Rotate counter-clockwise around the X axis. */\n  rotateX(radians: number) {\n    return this.addOp(\n      this.matrix.rotateX(radians),\n      m => m.rotateX(-radians)\n    );\n  }\n\n  /** Rotate counter-clockwise around the Y axis. */\n  rotateY(radians: number) {\n    return this.addOp(\n      this.matrix.rotateY(radians),\n      m => m.rotateY(-radians)\n    );\n  }\n\n  /** Rotate counter-clockwise around the Z axis. */\n  rotateZ(radians: number) {\n    return this.addOp(\n      this.matrix.rotateZ(radians),\n      m => m.rotateZ(-radians)\n    );\n  }\n\n  /** Return the inverse of the matrix. */\n  inverse(): Matrix3D {\n    let matrix = new Matrix3D();\n\n    for (let inverseOp of this.ops) {\n      matrix = inverseOp(matrix);\n    }\n\n    return matrix;\n  }\n}\n","import { Points3D } from \"./points-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\nexport function makeSpaceship(): Points3D {\n  const leftHalf = Points3D.fromArray([\n    -0.5, 0, 0,\n    0, 0.75, 0,\n    0, 0.15, 0\n  ]);\n\n  return leftHalf.concat(leftHalf.mirrorHorizontally());\n}\n\nexport function makeGround(y = -1, xzStart = -1, size = 2, pointsPerAxis = 20): Points3D {\n  const points: number[] = [];\n  let xPart = xzStart;\n  let zPart = xzStart;\n  let partInc = 1 / pointsPerAxis;\n\n  for (let i = 0; i <= pointsPerAxis; i++) {\n    points.push(xPart, y, zPart);\n    points.push(xPart, y, zPart + size);\n    xPart += size * partInc;\n  }\n\n  xPart = xzStart;\n  for (let i = 0; i <= pointsPerAxis; i++) {\n    points.push(xPart, y, zPart);\n    points.push(xPart + size, y, zPart);\n    zPart += size * partInc;\n  }\n\n  return Points3D.fromArray(points);\n}\n\nexport function makeRay(start: Vector3D, ray: Vector3D, segments = 10, length = 5): Points3D {\n  let point = start;\n  const increment = ray.normalize().times(length / segments);\n  const points: number[] = [];\n\n  for (let i = 0; i < segments; i++) {\n    points.push(point.x, point.y, point.z);\n    point = point.plus(increment);\n    points.push(point.x, point.y, point.z);\n  }\n\n  return Points3D.fromArray(points);\n}\n","import { Vector3D } from \"./vector-3d\";\n\nexport class Points3D {\n  constructor(private readonly array: Vector3D[]) {\n  }\n\n  toFloat32Array(): Float32Array {\n    const { array } = this;\n    const result = new Float32Array(array.length * 3);\n    let arrIndex = 0;\n\n    for (let i = 0; i < result.length; i += 3) {\n      result[i] = array[arrIndex].x;\n      result[i + 1] = array[arrIndex].y;\n      result[i + 2] = array[arrIndex].z;\n      arrIndex += 1;\n    }\n\n    return result;\n  }\n\n  concat(points: Points3D): Points3D {\n    const combined = this.array.concat(points.array);\n    return new Points3D(combined);\n  }\n\n  mirrorHorizontally(): Points3D {\n    return new Points3D(this.array.map(point => {\n      return new Vector3D(-point.x, point.y, point.z);\n    }));\n  }\n\n  get length(): number {\n    return this.array.length;\n  }\n\n  static fromArray(array: number[]|Float32Array) {\n    const numPoints = array.length / 3;\n    const pointArray = new Array<Vector3D>(numPoints);\n    let arrIndex = 0;\n    for (let i = 0; i < numPoints; i++) {\n      const x = array[arrIndex];\n      const y = array[arrIndex + 1];\n      const z = array[arrIndex + 2];\n      pointArray[i] = new Vector3D(x, y, z);\n      arrIndex += 3;\n    }\n    return new Points3D(pointArray);\n  }\n}\n","import { PerspectiveOptions, Matrix3D } from \"./matrix-3d\";\nimport { Vector3D } from \"./vector-3d\";\n\nexport type Point2D = {\n  x: number,\n  y: number\n};\n\nexport type Dimensions2D = {\n  width: number,\n  height: number\n};\n\n/**\n * Convert the given screen coordinates, in pixels, to\n * eye coordinates (from the perspective of the camera).\n */\nfunction screenCoordsToEye(canvas: Dimensions2D, point: Point2D, perspective: PerspectiveOptions): Vector3D {\n  const width = perspective.right - perspective.left;\n  const height = perspective.top - perspective.bottom;\n  const xPct = (point.x / canvas.width);\n  // Note that we need to flip the y-axis.\n  const yPct = ((canvas.height - point.y) / canvas.height);\n\n  const x = perspective.left + xPct * width;\n  const y = perspective.bottom + yPct * height;\n\n  // We need to flip the near value because it's specified in\n  // clip coordinates.\n  const z = -perspective.near;\n\n  return new Vector3D(x, y, z);\n}\n\n/**\n * Convert the given pixel coordinates on the given canvas to\n * points in the world.\n */\nexport function screenCoordsToWorld(\n  canvas: Dimensions2D,\n  point: Point2D,\n  perspective: PerspectiveOptions,\n  cameraTransform: Matrix3D\n): Vector3D {\n  const pointRelativeToCamera = screenCoordsToEye(canvas, point, perspective);\n  return cameraTransform.transformVector(pointRelativeToCamera);\n}\n","/**\n * Convenience class to store a value and detect\n * whether it has changed since the last time\n * we checked.\n */\nexport class CheckableValue<T> {\n  private lastCheckedValue: T|null = null;\n  private value: T|null = null;\n\n  /** Set the value. */\n  set(value: T) {\n    this.value = value;\n  }\n\n  /**\n   * If the value has changed since the last\n   * time we checked, pass it to the given callback\n   * function. Otherwise, do nothing.\n   */\n  check(cb: (value: T) => void) {\n    if (this.value === this.lastCheckedValue) {\n      return;\n    }\n    this.lastCheckedValue = this.value;\n    if (this.value) {\n      cb(this.value);\n    }\n  }\n}\n","module.exports = \"attribute vec4 a_position;\\n\\nuniform mat4 u_transform;\\n\\nvoid main() {\\n  gl_Position = u_transform * a_position;\\n}\\n\";","module.exports = \"precision mediump float;\\n\\nvoid main() {\\n  // This essentially visualizes the z-buffer. Taken from:\\n  //\\n  //   https://learnopengl.com/Advanced-OpenGL/Depth-testing\\n  gl_FragColor = vec4(vec3(gl_FragCoord.z), 1.0);\\n}\\n\";"],"sourceRoot":""}