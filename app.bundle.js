!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e,r,n=1){this.x=t,this.y=e,this.z=r,this.w=n}perspectiveDivide(){const{x:t,y:e,z:r,w:o}=this;return new n(t/o,e/o,r/o)}minus(t){const{x:e,y:r,z:o,w:s}=this;return new n(e-t.x,r-t.y,o-t.z,s)}plus(t){const{x:e,y:r,z:o,w:s}=this;return new n(e+t.x,r+t.y,o+t.z,s)}times(t){const{x:e,y:r,z:o,w:s}=this;return new n(e*t,r*t,o*t,s)}dot(t){const{x:e,y:r,z:n,w:o}=this;return e*t.x+r*t.y+n*t.z}normalize(){const{x:t,y:e,z:r,w:o}=this,s=Math.sqrt(t*t+e*e+r*r);return new n(t/s,e/s,r/s,o)}static fromVectorOrCoords(t,e,r){return r=t instanceof n?t.z:r||0,e=t instanceof n?t.y:e||0,t=t instanceof n?t.x:t,new n(t,e,r)}}e.Vector3D=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(0),o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];class s{constructor(t=o){this.values=t,this.valueAt=this.valueAt.bind(this)}toFloat32Array(){const t=this.valueAt;return new Float32Array([t(1,1),t(2,1),t(3,1),t(4,1),t(1,2),t(2,2),t(3,2),t(4,2),t(1,3),t(2,3),t(3,3),t(4,3),t(1,4),t(2,4),t(3,4),t(4,4)])}valueAt(t,e){return this.values[t-1][e-1]}translate(t,e,r){const o=n.Vector3D.fromVectorOrCoords(t,e,r);return this.multiply(new s([[1,0,0,o.x],[0,1,0,o.y],[0,0,1,o.z],[0,0,0,1]]))}scale(t){return this.multiply(new s([[t,0,0,0],[0,t,0,0],[0,0,t,0],[0,0,0,1]]))}rotateX(t){const e=Math.cos(t),r=Math.sin(t);return this.multiply(new s([[1,0,0,0],[0,e,r,0],[0,-r,e,0],[0,0,0,1]]))}rotateY(t){const e=Math.cos(t),r=Math.sin(t);return this.multiply(new s([[e,0,-r,0],[0,1,0,0],[r,0,e,0],[0,0,0,1]]))}rotateZ(t){const e=Math.cos(t),r=Math.sin(t);return this.multiply(new s([[e,-r,0,0],[r,e,0,0],[0,0,1,0],[0,0,0,1]]))}multiply(t){const e=this.transformVector(t.column(1)),r=this.transformVector(t.column(2)),n=this.transformVector(t.column(3)),o=this.transformVector(t.column(4));return new s([[e.x,r.x,n.x,o.x],[e.y,r.y,n.y,o.y],[e.z,r.z,n.z,o.z],[e.w,r.w,n.w,o.w]])}map(t){return new s(this.values.map(e=>e.map(t)))}multiplyByConstant(t){return this.map(e=>e*t)}static perspectiveProjection(t){const{near:e,far:r,left:n,right:o,top:i,bottom:a}=t,c=o-n,u=i-a,l=r-e,h=2*e;return new s([[h/c,0,(o+n)/c,0],[0,h/u,(i+a)/u,0],[0,0,-(r+e)/l,-2*r*e/l],[0,0,-1,0]])}transformVector(t){const e=this.valueAt;return new n.Vector3D(e(1,1)*t.x+e(1,2)*t.y+e(1,3)*t.z+e(1,4)*t.w,e(2,1)*t.x+e(2,2)*t.y+e(2,3)*t.z+e(2,4)*t.w,e(3,1)*t.x+e(3,2)*t.y+e(3,3)*t.z+e(3,4)*t.w,e(4,1)*t.x+e(4,2)*t.y+e(4,3)*t.z+e(4,4)*t.w)}column(t){const e=this.valueAt;return new n.Vector3D(e(1,t),e(2,t),e(3,t),e(4,t))}}e.Matrix3D=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(3),o=r(4),s=r(1),i=r(0),a=r(5),c=r(6),u=r(8),l=r(9),h=r(10),f=r(11),m=r(12),d=r(13),p=r(14);class w{constructor(t){this.z=t,this.orbitTheta=Math.random(),this.orbitThetaVelocity=.01*Math.random(),this.distanceFromCenter=Math.random(),this.scale=.5,this.shipTheta=Math.random(),this.shipThetaVelocity=.05*Math.random(),this.intersectionRadiusScale=.5,this.transform=this.recomputeTransform()}recomputeTransform(){const t=(new s.Matrix3D).rotateZ(this.orbitTheta).translate(this.distanceFromCenter,0,this.z).scale(this.scale).rotateY(this.shipTheta);return this.transform=t}get intersectionRadius(){return this.scale*this.intersectionRadiusScale}getIntersectionSphereTransform(){return this.transform.scale(this.intersectionRadiusScale)}center(){return this.transform.transformVector(new i.Vector3D(0,0,0))}doesRayIntersect(t){return null!==f.getRaySphereIntersection(t,this.center(),this.intersectionRadius)}update(){this.orbitTheta+=this.orbitThetaVelocity,this.shipTheta+=this.shipThetaVelocity,this.recomputeTransform()}}window.addEventListener("DOMContentLoaded",()=>{const t=document.createElement("canvas");document.body.appendChild(t),t.width=800,t.height=800,t.style.border="1px solid black";const e=t.getContext("webgl");if(!e)throw new Error("webgl is not supported on this browser!");const r=m.getElement("input","#show-colliders"),f=new class extends n.GlProgram{constructor(t){super(t,d,p),this.transform=new n.GlUniformMatrix3D(this,"u_transform"),this.positionAttributeLocation=n.getAttribLocation(t,this.program,"a_position")}}(e),y=new o.Points3DRenderer(f,c.makeSpaceship()),g=new o.Points3DRenderer(f,c.makeGround()),b=new o.Points3DRenderer(f,c.makeCircle());let v=null;const x={top:1,bottom:-1,right:1,left:-1,near:1,far:3},_=s.Matrix3D.perspectiveProjection(x);let P=[];let D=new l.CheckableValue;for(let t=0;t<30;t++)P.push(new w(t/30*2-1));t.onclick=(t=>{D.set({x:t.offsetX,y:t.offsetY})}),console.log("Initialization successful!");let A=0;const M=()=>{const n=(new a.InvertibleTransforms3D).rotateY(A).translate(0,0,2.25),s=n.inverse(),l=_.multiply(s);D.check(e=>{const r=function(t){return t.matrix.transformVector(new i.Vector3D(0,0,0))}(n),s=u.screenCoordsToWorld(t,e,x,n.matrix),a=h.Ray3D.fromTo(r,s);P=P.filter(t=>!t.doesRayIntersect(a)),v=new o.Points3DRenderer(f,c.makeRayPoints(a))}),A+=.001,e.viewport(0,0,e.canvas.width,e.canvas.height),e.enable(e.DEPTH_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),f.activate(),v&&(v.setupForDrawing(),f.transform.set(l),v.draw(e.LINES)),g.setupForDrawing(),f.transform.set(l),g.draw(e.LINES),y.setupForDrawing(),P.forEach(t=>{f.transform.set(l.multiply(t.transform)),y.draw(),t.update()}),r.checked&&(b.setupForDrawing(),P.forEach(t=>{const r=l.multiply(t.getIntersectionSphereTransform());f.transform.set(r),b.draw(e.LINE_LOOP),f.transform.set(r.rotateX(Math.PI/2)),b.draw(e.LINE_LOOP),f.transform.set(r.rotateY(Math.PI/2)),b.draw(e.LINE_LOOP)})),window.requestAnimationFrame(M)};M()})},function(t,e,r){"use strict";function n(t,e,r){const n=t.createShader(e);if(!n)throw new Error("gl.createShader() failed!");if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e="Compiling shader failed: "+t.getShaderInfoLog(n);throw t.deleteShader(n),new Error(e)}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getAttribLocation=function(t,e,r){const n=t.getAttribLocation(e,r);if(-1===n)throw new Error(`Unable to find attribute '${r}'!`);return n};e.GlProgram=class{constructor(t,e,r){this.gl=t;const o=n(t,WebGLRenderingContext.VERTEX_SHADER,e),s=n(t,WebGLRenderingContext.FRAGMENT_SHADER,r);this.program=function(t,e,r){const n=t.createProgram();if(!n)throw new Error("gl.createProgram() failed!");if(t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){const e="Linking program failed: "+t.getProgramInfoLog(n);throw t.deleteProgram(n),new Error(e)}return n}(t,o,s)}activate(){this.gl.useProgram(this.program)}};class o{constructor(t,e){this.program=t,this.location=function(t,e,r){const n=t.getUniformLocation(e,r);if(null===n)throw new Error(`Unable to find uniform '${r}'!`);return n}(t.gl,t.program,e)}}e.GlUniformVector=class extends o{set(t){this.program.gl.uniform4fv(this.location,t)}};e.GlUniformFloat=class extends o{set(t){this.program.gl.uniform1f(this.location,t)}};e.GlUniformMatrix3D=class extends o{set(t){this.program.gl.uniformMatrix4fv(this.location,!1,t.toFloat32Array())}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Points3DRenderer=class{constructor(t,e){this.program=t,this.points=e;const{gl:r}=t,n=r.createBuffer();if(null===n)throw new Error("gl.createBuffer() failed!");r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e.toFloat32Array(),r.STATIC_DRAW),this.buffer=n}setupForDrawing(){const{gl:t,positionAttributeLocation:e}=this.program;t.enableVertexAttribArray(e),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);const r=t.FLOAT;t.vertexAttribPointer(e,3,r,!1,0,0)}draw(t=WebGLRenderingContext.TRIANGLES){const{gl:e}=this.program,r=this.points.length;e.drawArrays(t,0,r)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(1),o=r(0);class s{constructor(t=new n.Matrix3D,e=[]){this.matrix=t,this.ops=e}addOp(t,e){return new s(t,[e,...this.ops])}translate(t,e,r){const n=o.Vector3D.fromVectorOrCoords(t,e,r);return this.addOp(this.matrix.translate(n),t=>t.translate(n.times(-1)))}rotateX(t){return this.addOp(this.matrix.rotateX(t),e=>e.rotateX(-t))}rotateY(t){return this.addOp(this.matrix.rotateY(t),e=>e.rotateY(-t))}rotateZ(t){return this.addOp(this.matrix.rotateZ(t),e=>e.rotateZ(-t))}inverse(){let t=new n.Matrix3D;for(let e of this.ops)t=e(t);return t}}e.InvertibleTransforms3D=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(7),o=r(0),s=r(1);e.makeSpaceship=function(){const t=n.Points3D.fromArray([-.5,0,0,0,.75,0,0,.15,0]);return t.concat(t.mirrorHorizontally())},e.makeGround=function(t=-1,e=-1,r=2,o=20){const s=[];let i=e,a=e,c=1/o;for(let e=0;e<=o;e++)s.push(i,t,a),s.push(i,t,a+r),i+=r*c;i=e;for(let e=0;e<=o;e++)s.push(i,t,a),s.push(i+r,t,a),a+=r*c;return n.Points3D.fromArray(s)},e.makeRayPoints=function(t,e=10,r=5){let o=t.origin;const s=t.direction.times(r/e),i=[];for(let t=0;t<e;t++)i.push(o.x,o.y,o.z),o=o.plus(s),i.push(o.x,o.y,o.z);return n.Points3D.fromArray(i)},e.makeCircle=function(t=20){const e=[],r=new o.Vector3D(1,0,0);for(let n=0;n<t;n++){const o=(new s.Matrix3D).rotateZ(2*Math.PI*(n/t)).transformVector(r);e.push(o.x,o.y,o.z)}return n.Points3D.fromArray(e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(0);class o{constructor(t){this.array=t}toFloat32Array(){const{array:t}=this,e=new Float32Array(3*t.length);let r=0;for(let n=0;n<e.length;n+=3)e[n]=t[r].x,e[n+1]=t[r].y,e[n+2]=t[r].z,r+=1;return e}concat(t){const e=this.array.concat(t.array);return new o(e)}mirrorHorizontally(){return new o(this.array.map(t=>new n.Vector3D(-t.x,t.y,t.z)))}get length(){return this.array.length}static fromArray(t){const e=t.length/3,r=new Array(e);let s=0;for(let o=0;o<e;o++){const e=t[s],i=t[s+1],a=t[s+2];r[o]=new n.Vector3D(e,i,a),s+=3}return new o(r)}}e.Points3D=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(0);e.screenCoordsToWorld=function(t,e,r,o){const s=function(t,e,r){const o=r.right-r.left,s=r.top-r.bottom,i=e.x/t.width,a=(t.height-e.y)/t.height,c=r.left+i*o,u=r.bottom+a*s,l=-r.near;return new n.Vector3D(c,u,l)}(t,e,r);return o.transformVector(s)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CheckableValue=class{constructor(){this.lastCheckedValue=null,this.value=null}set(t){this.value=t}check(t){this.value!==this.lastCheckedValue&&(this.lastCheckedValue=this.value,this.value&&t(this.value))}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e){this.origin=t,this.direction=e.normalize()}pointAlong(t){return this.origin.plus(this.direction.times(t))}static fromTo(t,e){const r=e.minus(t);return new n(t,r)}}e.Ray3D=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getRaySphereIntersection=function(t,e,r){const n=t.origin.minus(e),o=t.direction.dot(n),s=o*o-(n.dot(n)-r*r);if(s<0)return null;const i=Math.sqrt(s),a=[-o+i,-o-i].filter(t=>t>=0);if(0===a.length)return null;const c=a.sort((t,e)=>t-e)[0];return t.pointAlong(c)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getElement=function(t,e,r=document){const n=`${t}${e}`,o=r.querySelector(n);if(!o)throw new Error(`Couldn't find any elements matching "${n}"`);return o}},function(t,e){t.exports="attribute vec4 a_position;\n\nuniform mat4 u_transform;\n\nvoid main() {\n  gl_Position = u_transform * a_position;\n}\n"},function(t,e){t.exports="precision mediump float;\n\nvoid main() {\n  // This essentially visualizes the z-buffer. Taken from:\n  //\n  //   https://learnopengl.com/Advanced-OpenGL/Depth-testing\n  gl_FragColor = vec4(vec3(gl_FragCoord.z), 1.0);\n}\n"}]);
//# sourceMappingURL=app.bundle.js.map